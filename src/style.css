/*
  flymd 样式（中文注释）
  目标：极简、即开即见，默认全屏编辑；预览为覆盖层，Ctrl+E 切换
*/


:root {
  color-scheme: light dark;
  --bg: #ffffff;
  --fg: #1f2328;
  --muted: #7a7a7a;
  --border: #e5e7eb;
  /* 阅读模式背景（羊皮纸质感，暖色护眼） */
  --preview-bg: #fbf5e6;          /* 纸面底色：淡米色 */
  /* 更清晰的边框与代码背景（所见模式用） */
  --border-strong: #cbd5e1; /* slate-300 */
  --panel-bg: #f3f4f6;
  /* 所见模式变量 */
  --wysiwyg-bg: #e9edf5;           /* 更深一点的蓝灰 */
  --wysiwyg-status-h: 24px;        /* 状态条高度 */
  --wysiwyg-status-bg: #d9e2f2;    /* 状态条背景 */
  --code-bg: #f6f8fa;              /* 代码块背景（亮） */
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0b0c0e;
    --fg: #e5e7eb;
    --muted: #9ca3af;
    --border: #1f2937;
    /* 深色阅读模式背景（暖黑，降低刺激） */
    --preview-bg: #12100d;
    --border-strong: #374151;      /* slate-700 */
    --panel-bg: #0e1217;
    /* 深色所见模式变量 */
    --wysiwyg-bg: #0b1016;         /* 更深的蓝黑 */
    --wysiwyg-status-bg: #0f1a24;  /* 状态条背景 */
    --code-bg: #111827;            /* 代码块背景（暗） */
  }
}
html, body, #app { height: 100%; }
html, body {
  margin: 0; padding: 0;
  background: var(--bg); color: var(--fg);
  /* 改进字体渲染 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 通用隐藏类 */
.hidden {
  display: none !important;
}

#app {
  animation: app-fadein 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes app-fadein {
  from {
    opacity: 0;
    transform: scale(0.98);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* 自定义滚动条样式 */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: transparent;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: rgba(127,127,127,0.3);
  border-radius: 5px;
  border: 2px solid transparent;
  background-clip: padding-box;
  transition: all 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(127,127,127,0.5);
  background-clip: padding-box;
}

::-webkit-scrollbar-thumb:active {
  background: rgba(127,127,127,0.7);
  background-clip: padding-box;
}

@media (prefers-color-scheme: dark) {
  ::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.2);
    background-clip: padding-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.3);
    background-clip: padding-box;
  }

  ::-webkit-scrollbar-thumb:active {
    background: rgba(255,255,255,0.4);
    background-clip: padding-box;
  }
}

/* 全局选中文本样式 */
::selection {
  background: rgba(37, 99, 235, 0.25);
  color: var(--fg);
}
::-moz-selection {
  background: rgba(37, 99, 235, 0.25);
  color: var(--fg);
}
@media (prefers-color-scheme: dark) {
  ::selection {
    background: rgba(96, 165, 250, 0.3);
  }
  ::-moz-selection {
    background: rgba(96, 165, 250, 0.3);
  }
}

/* 预览区域选中文本样式 */
.preview ::selection {
  background: rgba(37, 99, 235, 0.2);
}
.preview ::-moz-selection {
  background: rgba(37, 99, 235, 0.2);
}

/* 代码块内选中样式 */
.preview pre ::selection,
.preview code ::selection {
  background: rgba(37, 99, 235, 0.3);
}
.preview pre ::-moz-selection,
.preview code ::-moz-selection {
  background: rgba(37, 99, 235, 0.3);
}

.titlebar {
  height: 36px;
  display: flex;
  align-items: stretch;
  border-bottom: 1px solid var(--border);
  -webkit-app-region: drag; /* Windows 可拖动区域 */
  background: linear-gradient(180deg, var(--bg) 0%, rgba(127,127,127,0.02) 100%);
  backdrop-filter: blur(8px);
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

/* 菜单栏样式 - 类似 Windows 记事本 */
.menubar {
  -webkit-app-region: no-drag;
  display: flex;
  align-items: stretch;
}

.menu-item {
  -webkit-app-region: no-drag;
  display: flex;
  align-items: center;
  padding: 0 14px;
  font-size: 13px;
  font-weight: 500;
  color: var(--fg);
  cursor: pointer;
  user-select: none;
  border: none;
  background: transparent;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  border-radius: 6px;
  margin: 0 3px;
}

.menu-item:hover {
  background: rgba(37, 99, 235, 0.1);
  color: #2563eb;
  box-shadow: 0 2px 6px rgba(37, 99, 235, 0.15);
}

.menu-item:active {
  background: rgba(37, 99, 235, 0.15);
  box-shadow: 0 1px 3px rgba(37, 99, 235, 0.1);
}

@media (prefers-color-scheme: dark) {
  .menu-item:hover {
    background: rgba(96, 165, 250, 0.15);
    color: #60a5fa;
    box-shadow: 0 2px 6px rgba(96, 165, 250, 0.2);
  }
  .menu-item:active {
    background: rgba(96, 165, 250, 0.2);
  }
}

/* 更新红点提示：为有更新的菜单项显示小圆点 */
.menu-item.has-update::after {
  content: '';
  position: absolute;
  top: 8px;
  right: 8px;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  box-shadow: 0 0 0 2px var(--bg), 0 0 8px rgba(239, 68, 68, 0.6);
  animation: pulse-dot 2s ease-in-out infinite;
}

@keyframes pulse-dot {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.8; }
}

/* 插件下拉菜单样式 */
#plugin-dropdown-overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  z-index: 2147483601;
}

#plugin-dropdown-panel {
  position: absolute;
  left: 0;
  top: 0;
  min-width: 120px;
  background: var(--bg);
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  box-shadow: 0 10px 32px rgba(15, 23, 42, 0.2);
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  padding: 6px 0;
  transition: opacity 0.12s ease, transform 0.12s ease;
}

@media (prefers-color-scheme: dark) {
  #plugin-dropdown-panel {
    background: #1e293b;
    border-color: #334155;
    box-shadow: 0 10px 32px rgba(0, 0, 0, 0.5);
  }
}

#plugin-dropdown-panel button,
#plugin-dropdown-panel .plugin-menu-item {
  width: auto;
  text-align: left;
  border: none;
  background: transparent;
  font-size: 14px;
  color: var(--fg);
  padding: 8px 16px;
  cursor: pointer;
  display: block;
}

#plugin-dropdown-panel button:hover:not(:disabled) {
  background: #f1f5f9;
}

@media (prefers-color-scheme: dark) {
  #plugin-dropdown-panel button:hover:not(:disabled) {
    background: #334155;
  }
}

#plugin-dropdown-panel button:disabled {
  color: #cbd5e1;
  cursor: not-allowed;
  opacity: 0.5;
}

.plugin-menu-group-title {
  font-size: 12px;
  color: #94a3b8;
  padding: 4px 16px 6px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 600;
}

.plugin-menu-divider {
  height: 1px;
  background: #e2e8f0;
  margin: 4px 0;
}

@media (prefers-color-scheme: dark) {
  .plugin-menu-divider {
    background: #334155;
  }
}

.plugin-menu-note {
  font-size: 12px;
  color: #94a3b8;
  margin-left: 8px;
}

/* 插件菜单 - 通用菜单项样式 */
.plugin-menu-item {
  text-align: left;
  border: none;
  background: transparent;
  font-size: 14px;
  color: var(--fg);
  padding: 8px 16px;
  cursor: pointer;
  display: block;
  position: relative;
}

.plugin-menu-item:hover:not(.disabled) {
  background: #f1f5f9;
}

@media (prefers-color-scheme: dark) {
  .plugin-menu-item:hover:not(.disabled) {
    background: #334155;
  }
}

.plugin-menu-item.disabled {
  color: #cbd5e1;
  cursor: not-allowed;
  opacity: 0.5;
}

/* 插件菜单 - 子菜单支持 */
.plugin-menu-item.has-children {
  position: relative;
}

.plugin-menu-label {
  flex: 1;
}

.plugin-menu-arrow {
  margin-left: 8px;
  opacity: 0.6;
  font-size: 12px;
}

.plugin-menu-submenu {
  display: none;
  position: absolute;
  left: 100%;
  top: -4px;
  background: var(--bg);
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  box-shadow: 0 10px 32px rgba(15, 23, 42, 0.2);
  padding: 6px 0;
  min-width: 180px;
  max-width: 280px;
  z-index: 2147483602;
  pointer-events: auto;
}

@media (prefers-color-scheme: dark) {
  .plugin-menu-submenu {
    background: #1e293b;
    border-color: #334155;
    box-shadow: 0 10px 32px rgba(0, 0, 0, 0.5);
  }
}

/* 向左展开的子菜单 */
.plugin-menu-submenu.expand-left {
  left: auto;
  right: 100%;
}

/* 父菜单项悬停时显示子菜单 */
.plugin-menu-item.has-children:hover > .plugin-menu-submenu {
  display: block;
}

/* 确保子菜单本身悬停时保持显示 */
.plugin-menu-submenu:hover {
  display: block;
}

.titlebar .filename {
  flex: 1;
  display: flex;
  align-items: center;
  padding: 0 16px;
  font-size: 13px;
  font-weight: 500;
  color: var(--fg);
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  letter-spacing: 0.01em;
  transition: color 0.2s ease;
}

.titlebar .filename:hover {
  color: #2563eb;
}

@media (prefers-color-scheme: dark) {
  .titlebar .filename:hover {
    color: #60a5fa;
  }
}

.container {
  --gap-left-library: 0px;
  --gap-right-library: 0px;
  --ai-left-gap: 0px;
  --ai-right-gap: 0px;
  --ai-left: 300px;
  --ai-right: 300px;
  --workspace-left-gap: calc(var(--gap-left-library) + var(--ai-left-gap));
  --workspace-right-gap: calc(var(--gap-right-library) + var(--ai-right-gap));
  height: calc(100% - 36px);
  position: relative;
  background: var(--bg);
}
/* 所见模式：整体容器背景替换为专用色 */
.container.wysiwyg { /* legacy overlay 标记，保留但不隐藏容器，避免误伤 */ }
.container.wysiwyg-v2 { background: var(--wysiwyg-bg) !important; }

/* 编辑模式网格背景 - 应用到整个容器，包括左右留白 */
.container.edit-grid-bg:not(.wysiwyg-v2) {
  background-image:
    linear-gradient(rgba(127,127,127,0.08) 1px, transparent 1px),
    linear-gradient(90deg, rgba(127,127,127,0.08) 1px, transparent 1px);
  background-size: 20px 20px;
  background-position: -1px -1px;
}

/* 编辑器背景透明，显示容器的网格 */
.container.edit-grid-bg:not(.wysiwyg-v2) .editor {
  background: transparent;
}

.editor {
  width: 100%; height: 100%;
  border: none; outline: none; resize: none;
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  font-size: 14px; line-height: 1.7; color: var(--fg);
  background: var(--bg);
  padding: 20px 24px 40px 24px;
  box-sizing: border-box;
  letter-spacing: 0.01em;
  /* 添加侧栏展开的过渡动画 */
  transition: padding-left 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-top 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-right 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 编辑模式：定宽居中（与阅读/所见一致） */
.container:not(.wysiwyg):not(.wysiwyg-v2) .editor {
  display: block;
  margin-left: auto;
  margin-right: auto;
  box-sizing: content-box;
  width: min(
    var(--preview-max-width, 860px),
    max(0px, calc(100% - var(--workspace-left-gap, 0px) - var(--workspace-right-gap, 0px)))
  );
  padding-left: calc(24px + var(--workspace-left-gap, 0px));
  padding-right: calc(24px + var(--workspace-right-gap, 0px));
}

.preview {
  position: absolute; inset: 0;
  /* 仅显示竖向滚动条，隐藏横向滚动条，避免页面抖动且更清爽 */
  overflow-y: auto; overflow-x: hidden;
  padding-top: 16px;
  padding-bottom: 40px;
  padding-left: calc(20px + var(--workspace-left-gap, 0px));
  padding-right: calc(20px + var(--workspace-right-gap, 0px));
  background: var(--bg); color: var(--fg);
  /* 改进预览区域的字体和可读性 */
  font-family: var(--font-body, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji");
  font-size: 16px;
  line-height: 1.75;
  letter-spacing: 0.01em;
  /* 添加侧栏展开的过渡动画 */
  transition: padding-left 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-top 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-right 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding-bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.preview.hidden { display: none; }

/* 修复：阅读(预览)模式下 Ctrl+F 计数翻倍
   原因：预览遮罩显示时，底下的 textarea 仍可被浏览器“页面查找”命中，
         导致同一段文本在编辑器与预览各匹配一次，计数翻倍。
   方案：当预览可见时，将编辑器彻底从可见渲染树移除。
   注意：所见(WYSIWYG)模式已单独隐藏预览，不受本规则影响。 */
.container:not(.wysiwyg-v2):has(#preview:not(.hidden)) .editor {
  display: none !important; /* 从布局和查找目标中移除 */
  visibility: hidden !important; /* 进一步确保不被 find-in-page 计入 */
}

/* 阅读模式（非所见）背景：仅当不在所见模式时应用，避免影响所见叠加/真实所见 */
.container:not(.wysiwyg):not(.wysiwyg-v2) .preview {
  /* 羊皮纸效果：底色 + 轻微渐变暗角 + 细纹理（纯 CSS，无外部数据） */
  background-color: var(--preview-bg);
  background-image:
    radial-gradient(170% 120% at 50% -10%,
      rgba(255,255,255,0.45) 0%,
      rgba(255,255,255,0.18) 55%,
      rgba(0,0,0,0.06) 100%),
    radial-gradient(140% 100% at 50% 120%,
      rgba(255,255,255,0.08) 0%,
      rgba(0,0,0,0.04) 60%,
      rgba(0,0,0,0.08) 100%),
    repeating-linear-gradient(0deg,
      rgba(255,255,255,0.015) 0,
      rgba(255,255,255,0.015) 1px,
      transparent 1px,
      transparent 3px),
    repeating-linear-gradient(90deg,
      rgba(255,255,255,0.015) 0,
      rgba(255,255,255,0.015) 1px,
      transparent 1px,
      transparent 3px);
  background-size: auto, auto, 6px 6px, 6px 6px;
  background-blend-mode: normal, multiply, soft-light, soft-light;
  box-shadow: inset 0 0 0 1px rgba(120, 90, 40, 0.06),
              inset 0 40px 60px rgba(0, 0, 0, 0.03),
              inset 0 -30px 50px rgba(0, 0, 0, 0.02);
}

@media (prefers-color-scheme: dark) {
  .container:not(.wysiwyg):not(.wysiwyg-v2) .preview {
    background-image:
      radial-gradient(170% 120% at 50% -10%,
        rgba(255,255,255,0.12) 0%,
        rgba(255,255,255,0.06) 55%,
        rgba(0,0,0,0.35) 100%),
      radial-gradient(140% 100% at 50% 120%,
        rgba(255,255,255,0.05) 0%,
        rgba(0,0,0,0.10) 60%,
        rgba(0,0,0,0.22) 100%),
      repeating-linear-gradient(0deg,
        rgba(255,255,255,0.02) 0,
        rgba(255,255,255,0.02) 1px,
        transparent 1px,
        transparent 3px),
      repeating-linear-gradient(90deg,
        rgba(255,255,255,0.02) 0,
        rgba(255,255,255,0.02) 1px,
        transparent 1px,
        transparent 3px);
    background-size: auto, auto, 6px 6px, 6px 6px;
    background-blend-mode: normal, multiply, soft-light, soft-light;
    box-shadow: inset 0 0 0 1px rgba(80, 60, 30, 0.20),
                inset 0 40px 60px rgba(0, 0, 0, 0.25),
                inset 0 -30px 50px rgba(0, 0, 0, 0.20);
  }
}

/* 阅读模式下的代码块配色：与羊皮纸底色更协调（暖白叠加） */
.container:not(.wysiwyg):not(.wysiwyg-v2) .preview pre {
  background: rgba(255, 255, 255, 0.72);
  border-color: rgba(120, 90, 40, 0.12);
}
.container:not(.wysiwyg):not(.wysiwyg-v2) .preview :not(pre) > code {
  background: rgba(255, 255, 255, 0.66);
  border-color: rgba(120, 90, 40, 0.18);
}
@media (prefers-color-scheme: dark) {
  .container:not(.wysiwyg):not(.wysiwyg-v2) .preview pre {
    background: rgba(0, 0, 0, 0.35);
    border-color: rgba(240, 220, 180, 0.08);
  }
  .container:not(.wysiwyg):not(.wysiwyg-v2) .preview :not(pre) > code {
    background: rgba(0, 0, 0, 0.28);
    border-color: rgba(240, 220, 180, 0.10);
  }
}

/* 所见 V2：真实所见视图容器 */
#md-wysiwyg-root, #md-wysiwyg-root * { box-sizing: border-box; }
#md-wysiwyg-root {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  display: none;
  overflow-y: auto;
  overflow-x: hidden;
  z-index: 2;
  /* 添加侧栏展开的过渡动画 */
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.container:not(.wysiwyg-v2) #md-wysiwyg-root {
  left: var(--workspace-left-gap, 0px);
  right: var(--workspace-right-gap, 0px);
  width: auto;
}
.container.wysiwyg-v2 #md-wysiwyg-root {
  left: var(--workspace-left-gap, 0px);
  right: var(--workspace-right-gap, 0px);
  width: auto;
}
.container.wysiwyg-v2 #md-wysiwyg-root { display: block; }
.container.wysiwyg-v2-loading #md-wysiwyg-root { display: none; }
.container.wysiwyg-v2 .editor { display: none; }
.container.wysiwyg-v2-loading .editor { display: block; }
.container.wysiwyg-v2 .preview { display: none !important; }
/* 所见模式覆盖渲染容器：在 ProseMirror 之上渲染 Mermaid/KaTeX 预览 */
#md-wysiwyg-root .overlay-host { position: absolute; inset: 0; pointer-events: none; z-index: 5; }
#md-wysiwyg-root .overlay-host .ov-mermaid,
#md-wysiwyg-root .overlay-host .ov-katex,
#md-wysiwyg-root .overlay-host .ov-codecopy { pointer-events: none; }
#md-wysiwyg-root .overlay-host .ov-mermaid > div,
#md-wysiwyg-root .overlay-host .ov-katex > div,
#md-wysiwyg-root .overlay-host .ov-codecopy > .code-copy { pointer-events: auto; }
/* 保证所见 V2 的滚动容器占满并可滚动 */
#md-wysiwyg-root .scrollView { height: 100%; overflow-y: auto; }
/* 兜底：Milkdown 根容器（通常为 .milkdown）与其第一级子元素占满高度 */
#md-wysiwyg-root > .milkdown { display: block; min-height: 100%; height: 100%; }
#md-wysiwyg-root > div { display: block; min-height: 100%; }

/* V2 状态提示（右下角） */
/* 右下角提示已取消 */

/* 如有富文本工具条，默认隐藏，纯所见编辑 */
#md-wysiwyg-root [role="toolbar"] { display: none !important; }
/* 隐藏 Milkdown block/slash 插件的 UI 组件（更精确的选择器，不影响内容块） */
#md-wysiwyg-root .milkdown-menu { display: none !important; }
#md-wysiwyg-root [data-block-handle] { display: none !important; }
#md-wysiwyg-root [data-slash-menu] { display: none !important; }
#md-wysiwyg-root .slash-dropdown { display: none !important; }
#md-wysiwyg-root .block-menu { display: none !important; }
/* 隐藏全局的浮动 UI 面板（portal 到 body 的元素） */
body > [data-tippy-root] { display: none !important; }
body > [data-block-handle] { display: none !important; }
body > [data-slash-menu] { display: none !important; }
body > .milkdown-menu { display: none !important; }
body > .slash-dropdown { display: none !important; }
body > .block-menu { display: none !important; }

/* ProseMirror 基础样式，确保 V2 视图可编辑、可滚动、行距正常 */
.container.wysiwyg-v2 .ProseMirror {
  min-height: 100%;
  padding: 14px 16px 40px 16px;
  outline: none;
  white-space: pre-wrap;
  word-break: break-word;
  color: var(--fg);
  /* 居中与阅读宽度（对齐预览的 preview-body） */
  max-width: var(--preview-max-width, 860px);
  margin: 0 auto;
  background: transparent;
  box-sizing: border-box;
  font-family: var(--font-body, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif);
  font-size: 16px;
  line-height: 1.75;
  letter-spacing: 0.01em;
}
.container.wysiwyg-v2 .ProseMirror img,
.container.wysiwyg-v2 .ProseMirror video { max-width: 100%; height: auto; }
.container.wysiwyg-v2 .ProseMirror table { width: auto; max-width: 100%; border-collapse: collapse; }
.container.wysiwyg-v2 .ProseMirror th,
.container.wysiwyg-v2 .ProseMirror td { border: 1px solid var(--border-strong); padding: 6px 8px; }
.container.wysiwyg-v2 .ProseMirror:focus { outline: none; }
.container.wysiwyg-v2 .ProseMirror p { margin: 1em 0; }

/* 所见模式标题样式 */
.container.wysiwyg-v2 .ProseMirror h1 {
  font-size: 2.2em;
  font-weight: 700;
  line-height: 1.2;
  margin: 1.8em 0 0.8em;
  border-bottom: 2px solid var(--border);
  padding-bottom: 0.3em;
}
.container.wysiwyg-v2 .ProseMirror h2 {
  font-size: 1.8em;
  font-weight: 700;
  line-height: 1.3;
  margin: 1.6em 0 0.7em;
  border-bottom: 1px solid var(--border);
  padding-bottom: 0.25em;
}
.container.wysiwyg-v2 .ProseMirror h3 {
  font-size: 1.4em;
  font-weight: 600;
  line-height: 1.4;
  margin: 1.4em 0 0.6em;
}
.container.wysiwyg-v2 .ProseMirror h4,
.container.wysiwyg-v2 .ProseMirror h5,
.container.wysiwyg-v2 .ProseMirror h6 {
  font-weight: 600;
  margin: 1.2em 0 0.5em;
}

.container.wysiwyg-v2 .ProseMirror pre {
  background: var(--code-bg);
  padding: 20px;
  border-radius: 12px;
  overflow: auto;
  border: none;
  font-family: var(--font-mono, "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  margin: 16px 0;
}
.container.wysiwyg-v2 .ProseMirror code {
  font-family: var(--font-mono, "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  background: var(--code-bg);
  padding: 2px 8px;
  border-radius: 6px;
  border: none;
  font-weight: 500;
}
.container.wysiwyg-v2 .ProseMirror blockquote {
  border-left: 4px solid var(--border-strong);
  padding-left: 1.2em;
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  margin: 1.2em 0;
  background: rgba(127,127,127,0.04);
  border-radius: 0 8px 8px 0;
  font-style: italic;
}

/* 所见模式的临时预览 UI 提升可见性 */
#wysi-preview-popover { border-color: var(--border-strong) !important; }
#wysi-float-preview { border-color: var(--border-strong) !important; }
#md-wysiwyg-root .mmd-preview { border-color: var(--border-strong) !important; }

/* 所见模式覆盖：即使预览带有 hidden 类，也强制显示 */
.container.wysiwyg .preview.hidden { display: block; }

/* 所见模式：预览在下，编辑器在上（透明文字，仅显示光标） */
.container.wysiwyg .preview {
  z-index: 1;
  opacity: 1;
  pointer-events: none; /* 不拦截点击，V1 仅显示 */
  /* 与编辑器对齐（避免文字看起来在光标“下面”） */
  padding: 14px 16px 40px 16px; /* 与 .editor 一致 */
  /* 使用与编辑器完全一致的等宽字体，保证 ch 宽度一致 */
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  font-size: 14px; /* 与 .editor 一致 */
  /* 微调变量（如需细调可在运行时动态注入样式覆盖） */
  --w-nudge-x: 0.5ch;   /* 标题横向整体微调，默认约半个西文字符 */
  --w-head-top: -0.10em;/* 标题纵向上移，缓解“在下方”感受 */
}
.container.wysiwyg .editor {
  position: relative;
  z-index: 2;
  background: transparent;
  color: transparent;          /* 隐藏文本 */
  caret-color: var(--fg);      /* 仍显示光标 */
  /* 使用与常规编辑相同的等宽字体，确保字符宽度匹配 */
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  line-height: 1.6;            /* 与预览一致 */
}

/* 可选：所见模式隐藏光标，结合“高亮当前行”使用 */
/* 所见模式：显式要求隐藏系统插入符（取消光标） */
.container.wysiwyg.no-caret .editor { caret-color: transparent !important; }
/* 同时禁用自定义覆盖光标 */
.container.wysiwyg.no-caret .wysiwyg-caret { display: none !important; }

/* 所见模式：高亮当前编辑的逻辑行（整页宽，指示当前位置） */
.container.wysiwyg .wysiwyg-line {
  position: absolute;
  left: 0;
  right: 0;
  height: 1.6em;
  background: linear-gradient(90deg,
    rgba(127,127,127,0.08) 0%,
    rgba(127,127,127,0.12) 50%,
    rgba(127,127,127,0.08) 100%);
  z-index: 2;
  pointer-events: none;
  display: none;
  border-radius: 4px;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 0 1px rgba(127,127,127,0.08);
}
.container.wysiwyg .wysiwyg-line.show {
  display: block;
}

/* 所见模式：点状光标（替代竖线光标） */
.container.wysiwyg .wysiwyg-caret {
  position: absolute;
  z-index: 3;
  pointer-events: none;
  /* 采用"终端式"下划线光标：宽度等于 1 个字符宽，厚度稍微增加 */
  font-family: var(--font-mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  width: 1ch;
  height: 3px;
  border-radius: 2px;
  background: var(--fg);
  /* 以 left 顶边为锚点，不再居中偏移 */
  transform: none;
  display: none;
  box-shadow: 0 0 4px rgba(0,0,0,0.3);
  transition: opacity 0.1s ease;
}
.container.wysiwyg .wysiwyg-caret.show { display: block; }
/* 光标闪烁动画（所见模式） */
@keyframes caret-blink {
  0%, 49% { opacity: 1; }
  50%, 100% { opacity: 0; }
}
.container.wysiwyg .wysiwyg-caret.show {
  animation: caret-blink 1s steps(1, end) infinite;
}
@media (prefers-reduced-motion: reduce) {
  .container.wysiwyg .wysiwyg-caret.show { animation: none; }
}
/* 注入到预览中的点状“光标”样式 */
.container.wysiwyg .preview .caret-dot {
  color: var(--fg);
  animation: caret-blink 1s steps(1, end) infinite;
}

/* 取消预览正文的居中与段落外边距，使与 textarea 行基线更贴合 */
.container.wysiwyg .preview-body { max-width: none; margin: 0; }
.container.wysiwyg .preview p { margin: 0; }
/* 使段落/标题换行行为更贴近 textarea */
.container.wysiwyg .preview p,
.container.wysiwyg .preview h1,
.container.wysiwyg .preview h2,
.container.wysiwyg .preview h3,
.container.wysiwyg .preview h4,
.container.wysiwyg .preview h5,
.container.wysiwyg .preview h6 { white-space: pre-wrap; word-break: break-word; }
/* 所见模式：代码块与编辑器严格对齐 */
.container.wysiwyg .preview pre {
  margin-top: 0; margin-bottom: 0;
  padding-top: 0; padding-bottom: 0;
  line-height: 1.6; /* 与 .editor 相同 */
}
.container.wysiwyg .preview pre code {
  font-size: 14px; /* 与 .editor 相同 */
  line-height: 1.6;
}

/* 标题在所见模式下的对齐优化：
   - 移除上下外边距，避免块级顶部下坠
   - 统一行高到与编辑器一致
   - 使用 text-indent + padding-left 抵消 Markdown 源中 "# " 前缀在横向上的差异
*/
.container.wysiwyg .preview h1,
.container.wysiwyg .preview h2,
.container.wysiwyg .preview h3,
.container.wysiwyg .preview h4,
.container.wysiwyg .preview h5,
.container.wysiwyg .preview h6 {
  margin: 0;
  line-height: 1.6;        /* 使用与编辑器一致的行高（单位less）*/
  position: relative;
  top: var(--w-head-top);
  font-size: 1em;          /* 基准字体大小与编辑器一致 */
  font-weight: 700;        /* 保留“标题感” */
  display: block;          /* 块级，避免多个标题同排显示 */
  transform-origin: left top;
}

/* 标题放大采用 transform，不改变行框高度，从而与输入光标保持一致。
   同时将左侧缩进按比例缩放前反向抵消，保证“# ”被移除后起点对齐。*/
.container.wysiwyg .preview h1 {
  --hscale: 1.60;
  transform: scale(var(--hscale));
  text-indent: calc((-2ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((2ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.60em; /* 为放大后的视觉高度预留空间，避免压住下一行 */
}
.container.wysiwyg .preview h2 {
  --hscale: 1.40;
  transform: scale(var(--hscale));
  text-indent: calc((-3ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((3ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.45em;
}
.container.wysiwyg .preview h3 {
  --hscale: 1.20;
  transform: scale(var(--hscale));
  text-indent: calc((-4ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((4ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.30em;
}
.container.wysiwyg .preview h4 {
  --hscale: 1.10;
  transform: scale(var(--hscale));
  text-indent: calc((-5ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((5ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.20em;
}
.container.wysiwyg .preview h5 {
  --hscale: 1.00;
  transform: scale(var(--hscale));
  text-indent: calc((-6ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((6ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.10em;
}
.container.wysiwyg .preview h6 {
  --hscale: 1.00;
  transform: scale(var(--hscale));
  text-indent: calc((-7ch - var(--w-nudge-x)) / var(--hscale));
  padding-left: calc((7ch + var(--w-nudge-x)) / var(--hscale));
  padding-bottom: 0.10em;
}

/* 预览正文容器：定宽居中，类似 Typora/Word 的阅读宽度 */
.preview-body {
  max-width: var(--preview-max-width, 860px);   /* 与所见模式一致 */
  margin: 0 auto;
  padding: 14px 16px 20px 16px; /* 与所见模式保持一致 */
  /* 添加过渡动画，配合侧栏展开 */
  transition: max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 文档库侧栏（阶段A：最小侵入） */
.library {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 280px;
  background: var(--panel-bg);
  color: var(--fg);
  overflow-y: auto;
  overflow-x: hidden;
  z-index: 15;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
}
.library.side-left {
  left: 0;
  right: auto;
  border-right: 1px solid var(--border);
  border-left: none;
  box-shadow: 2px 0 8px rgba(0,0,0,0.05);
}
.library.side-right {
  right: 0;
  left: auto;
  border-left: 1px solid var(--border);
  border-right: none;
  box-shadow: -2px 0 8px rgba(0,0,0,0.05);
}
.library.hidden {
  opacity: 0;
  pointer-events: none;
}
.library.side-left.hidden {
  transform: translateX(-100%);
}
.library.side-right.hidden {
  transform: translateX(100%);
}
.library .lib-header { position: sticky; top: 0; background: var(--panel-bg); border-bottom: 1px solid var(--border); padding: 10px 12px; display: flex; flex-direction: column; gap: 10px; z-index: 1; }
.library .lib-title-row { display: flex; align-items: center; gap: 10px; padding-bottom: 2px; }
.library .lib-choose-btn { -webkit-app-region: no-drag; cursor: pointer; border: none; background: rgba(127,127,127,0.12); color: var(--fg); border-radius: 8px; padding: 6px 14px; font-size: 13px; font-weight: 600; transition: all 0.15s ease; flex-shrink: 0; }
.library .lib-choose-btn:hover { background: rgba(127,127,127,0.2); }
.library .lib-choose-btn:active { background: rgba(127,127,127,0.25); }
.library .lib-name { flex: 1; color: var(--fg); overflow: hidden; white-space: nowrap; text-overflow: ellipsis; font-size: 14px; font-weight: 600; padding-left: 4px; opacity: 0.9; }
.library .lib-toggle-btn { -webkit-app-region: no-drag; cursor: pointer; border: none; background: none; color: var(--fg); font-size: 18px; width: 30px; height: 30px; display: none; align-items: center; justify-content: center; transition: opacity 0.2s, background 0.2s; border-radius: 4px; margin: 0 2px; padding: 0; line-height: 1; font-weight: 300; opacity: 0.5; font-family: monospace; flex-shrink: 0; }
.library .lib-toggle-btn:hover { opacity: 0.8; background: rgba(127, 127, 127, 0.1); }
body.focus-mode .library .lib-toggle-btn { display: flex; }
.lib-float-toggle { -webkit-app-region: no-drag; cursor: pointer; border: none; background: none; color: var(--fg); font-size: 18px; width: 30px; height: 30px; display: none; align-items: center; justify-content: center; transition: opacity 0.2s, background 0.2s; border-radius: 4px; padding: 0; line-height: 1; font-weight: 300; opacity: 0.5; font-family: monospace; position: fixed; top: 12px; left: 12px; z-index: 90; }
.lib-float-toggle.side-left { left: 12px; right: auto; }
.lib-float-toggle.side-right { left: auto; right: 12px; }
.lib-float-toggle:hover { opacity: 0.8; background: rgba(127, 127, 127, 0.1); }
body.focus-mode .lib-float-toggle.show { display: flex; }
.library .lib-actions { display: flex; align-items: center; gap: 6px; }
.library .lib-action-btn { -webkit-app-region: no-drag; cursor: pointer; border: 1px solid var(--border); background: rgba(127,127,127,0.04); color: var(--fg); border-radius: 6px; padding: 5px 10px; font-size: 12px; font-weight: 500; transition: all 0.15s ease; flex: 1; text-align: center; white-space: nowrap; writing-mode: horizontal-tb; word-break: keep-all; }
.library .lib-action-btn:hover { background: rgba(127,127,127,0.12); border-color: rgba(127,127,127,0.25); }
.library .lib-action-btn.active { background: rgba(127,127,127,0.18); color: var(--fg); border-color: rgba(127,127,127,0.3); font-weight: 600; }
.library .hidden { display: none !important; }
.library { -webkit-app-region: no-drag; }
.library .lib-tree { padding: 8px 6px 14px 6px; font-size: 13px; -webkit-app-region: no-drag; }
.library .lib-outline {
  padding: 10px 8px 16px 8px;
  font-size: 13px;
}

.library .lib-outline .ol-item {
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 400;
  line-height: 1.6;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  border-left: 3px solid transparent;
  margin: 2px 0;
  position: relative;
}

.library .lib-outline .ol-item:hover {
  background: linear-gradient(90deg, rgba(37,99,235,0.08) 0%, rgba(37,99,235,0.04) 100%);
  border-left-color: rgba(37,99,235,0.3);
  transform: translateX(2px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.library .lib-outline .ol-item.active {
  background: linear-gradient(90deg, rgba(37,99,235,0.15) 0%, rgba(37,99,235,0.08) 100%);
  border-left: 3px solid #2563eb;
  color: #2563eb;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(37,99,235,0.15);
  transform: translateX(2px);
}

@media (prefers-color-scheme: dark) {
  .library .lib-outline .ol-item:hover {
    background: linear-gradient(90deg, rgba(96,165,250,0.12) 0%, rgba(96,165,250,0.06) 100%);
    border-left-color: rgba(96,165,250,0.4);
  }

  .library .lib-outline .ol-item.active {
    background: linear-gradient(90deg, rgba(96,165,250,0.2) 0%, rgba(96,165,250,0.1) 100%);
    border-left-color: #60a5fa;
    color: #60a5fa;
    box-shadow: 0 2px 6px rgba(96,165,250,0.25);
  }
}

.library .lib-outline .ol-tg {
  display: inline-block;
  width: 16px;
  height: 16px;
  line-height: 16px;
  text-align: center;
  margin-right: 6px;
  border-radius: 4px;
  color: var(--muted);
  font-size: 11px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.library .lib-outline .ol-item:hover .ol-tg {
  color: #2563eb;
  background: rgba(37,99,235,0.1);
}

.library .lib-outline .ol-item.active .ol-tg {
  color: #2563eb;
  background: rgba(37,99,235,0.15);
}

@media (prefers-color-scheme: dark) {
  .library .lib-outline .ol-item:hover .ol-tg {
    color: #60a5fa;
    background: rgba(96,165,250,0.15);
  }

  .library .lib-outline .ol-item.active .ol-tg {
    color: #60a5fa;
    background: rgba(96,165,250,0.2);
  }
}

.library .lib-outline .lvl-1 {
  margin-left: 0;
  font-weight: 600;
  font-size: 14px;
  margin-top: 8px;
  margin-bottom: 4px;
}

.library .lib-outline .lvl-2 {
  margin-left: 12px;
  font-size: 13px;
}

.library .lib-outline .lvl-3 {
  margin-left: 24px;
  font-size: 13px;
  opacity: 0.95;
}

.library .lib-outline .lvl-4 {
  margin-left: 36px;
  font-size: 12px;
  opacity: 0.9;
}

.library .lib-outline .lvl-5 {
  margin-left: 48px;
  font-size: 12px;
  opacity: 0.85;
}

.library .lib-outline .lvl-6 {
  margin-left: 60px;
  font-size: 11px;
  opacity: 0.8;
}
.library .lib-node {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 6px;
  border-radius: 6px;
  cursor: default;
  user-select: none;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
.library .lib-node:hover {
  background: rgba(127,127,127,0.08);
  transform: translateX(2px);
}
.library .lib-dir { cursor: pointer; }
.library .lib-file { cursor: pointer; }
.library .lib-toggle { width: 12px; text-align: center; color: var(--muted); }
.library .lib-children { margin-left: 14px; }

/* 侧栏行内简易图标，避免 Emoji 字体兼容性问题 */
.library .lib-ico { display: inline-block; vertical-align: middle; width: 16px; height: 16px; fill: var(--muted); stroke: var(--muted); }
.library .lib-node:hover .lib-ico { fill: var(--fg); stroke: var(--fg); }
/* 保留文件图标的简易形状，后续可同样替换为 SVG */
.library .lib-ico-file { position: relative; width: 12px; height: 14px; border: 1px solid currentColor; border-radius: 2px; box-sizing: border-box; color: var(--muted); }
.library .lib-ico-file::after { content: ''; position: absolute; right: 0; top: 0; width: 0; height: 0; border-left: 4px solid transparent; border-bottom: 4px solid currentColor; }
/* 文档类型标识：在“纸张”上绘制 2-3 字母的类型缩写 */
.library .lib-ico-file::before { position: absolute; left: 1px; top: 0; font-size: 8px; line-height: 1; color: currentColor; }
.library .lib-ico-md::before { content: 'MD'; }
.library .lib-ico-txt::before { content: 'T'; font-size: 5px; top: 2px; }
/* TXT 使用紫色主题 */
.library .lib-ico-txt { color: #7c3aed; }
/* 悬浮时提亮 */
.library .lib-node:hover .lib-ico-file:not(.lib-ico-txt) { color: var(--fg); }
/* PDF：程序图标红色变体（通过 CSS 滤镜近似为红色），悬浮稍微增强 */
.library .lib-ico-app.lib-ico-pdf { filter: grayscale(1) sepia(1) hue-rotate(-10deg) saturate(8) brightness(0.95) contrast(1.05); }
.library .lib-node:hover .lib-ico-app.lib-ico-pdf { filter: grayscale(1) sepia(1) hue-rotate(-10deg) saturate(10) brightness(1) contrast(1.1); }

/* 文档库/AI 助手占用空间通过 CSS 变量告知容器 */
.container.with-library-left { --gap-left-library: 300px; }
.container.with-library-right { --gap-right-library: 300px; }
.container.with-ai-left { --ai-left-gap: var(--ai-left, 300px); }
.container.with-ai-right { --ai-right-gap: var(--ai-right, 300px); }

.statusbar {
  position: absolute;
  right: 14px;
  bottom: 50px;
  font-size: 12px;
  font-weight: 500;
  color: var(--muted);
  padding: 6px 12px;
  background: rgba(127,127,127,0.05);
  border: 1px solid var(--border);
  border-radius: 8px;
  backdrop-filter: blur(4px);
  transition: all 0.25s ease;
  letter-spacing: 0.02em;
}

.statusbar:hover {
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

/* 阅读模式和所见模式下隐藏状态栏 */
.container.wysiwyg-v2 .statusbar,
.preview:not(.hidden) ~ .statusbar {
  display: none;
}

/* 通知容器：支持多消息堆叠 */
.notification-container {
  position: fixed;
  right: 14px;
  bottom: 10px;
  z-index: 999999; /* 最高层级，确保不被任何弹窗遮挡 */
  display: flex;
  flex-direction: column-reverse; /* 新消息从下往上堆叠 */
  gap: 8px;
  pointer-events: none; /* 容器本身不拦截事件 */
}

/* 通知项 */
.notification-item {
  pointer-events: auto; /* 通知可交互 */
  font-size: 12px;
  font-weight: 500;
  color: var(--fg);
  padding: 8px 14px;
  border-radius: 8px;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(127,127,127,0.2);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  max-width: 400px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  animation: notificationSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transition: opacity 0.2s ease, transform 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.notification-item .notification-icon {
  font-size: 14px;
  line-height: 1;
  flex-shrink: 0;
}

.notification-item .notification-text {
  flex: 1;
  min-width: 0;
}

/* 可点击的通知 */
.notification-item.clickable {
  cursor: pointer;
  user-select: none;
}

.notification-item.clickable:hover {
  opacity: 0.85;
  transform: translateY(-1px);
}

.notification-item.clickable:active {
  transform: translateY(0);
}

/* 通知滑入动画 */
@keyframes notificationSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 向后兼容：旧的 sync-status ID */
#sync-status {
  /* 保持为空，已被 notification-container 替代 */
}

.sync-status:empty {
  display: none;
}

@media (prefers-color-scheme: dark) {
  .statusbar:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  }
}

/* 缩放状态显示，避免覆盖现有 status 文本（单独节点） */
.status-zoom { display: none; }
.status-zoom button {
  font-size: 12px;
  line-height: 1;
  padding: 2px 6px;
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 4px;
  color: var(--muted);
}
.status-zoom button:hover { background: rgba(127,127,127,0.12); color: var(--fg); }

/* 缩放气泡（参考 Edge 样式，居中底部弹出，自动隐藏） */
.zoom-bubble {
  position: fixed;
  left: 50%;
  bottom: 56px;
  transform: translateX(-50%);
  z-index: 9999;
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 500;
  color: #fff;
  background: linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(20, 20, 20, 0.95) 100%);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 10px;
  display: inline-flex;
  align-items: center;
  gap: 12px;
  backdrop-filter: blur(16px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.zoom-bubble #zoom-bubble-label {
  color: #fff;
  letter-spacing: 0.02em;
}

.zoom-bubble.show {
  opacity: 1;
  pointer-events: auto;
  transform: translateX(-50%) translateY(0) scale(1);
}

.zoom-bubble.hidden {
  opacity: 0;
  transform: translateX(-50%) translateY(8px) scale(0.95);
}

.zoom-bubble .zoom-reset-btn {
  border: 1px solid rgba(255,255,255,0.25);
  background: rgba(255,255,255,0.1);
  color: #fff;
  border-radius: 7px;
  padding: 5px 10px;
  font-size: 12px;
  font-weight: 500;
  line-height: 1;
  transition: all 0.2s ease;
  cursor: pointer;
}

.zoom-bubble .zoom-reset-btn:hover {
  background: rgba(255,255,255,0.2);
  transform: scale(1.05);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.zoom-bubble .zoom-reset-btn:active {
  transform: scale(0.95);
}

/* 阅读宽度气泡：靠近状态栏右侧显示 */
.width-bubble {
  left: auto;
  right: 24px;
  bottom: 56px;
  transform: translateY(0) scale(1);
}
.width-bubble.hidden {
  transform: translateY(8px) scale(0.95);
}

/* Markdown 基础排版（预览） */
.preview h1 {
  margin: 1.8em 0 0.8em;
  font-size: 2.2em;
  font-weight: 700;
  line-height: 1.2;
  letter-spacing: -0.02em;
  border-bottom: 2px solid var(--border);
  padding-bottom: 0.3em;
}
.preview h2 {
  margin: 1.6em 0 0.7em;
  font-size: 1.8em;
  font-weight: 700;
  line-height: 1.3;
  letter-spacing: -0.01em;
  border-bottom: 1px solid var(--border);
  padding-bottom: 0.25em;
}
.preview h3 {
  margin: 1.4em 0 0.6em;
  font-size: 1.4em;
  font-weight: 600;
  line-height: 1.4;
}
.preview h4 {
  margin: 1.2em 0 0.5em;
  font-size: 1.2em;
  font-weight: 600;
  line-height: 1.4;
}
.preview h5 {
  margin: 1.1em 0 0.4em;
  font-size: 1.05em;
  font-weight: 600;
  line-height: 1.5;
}
.preview h6 {
  margin: 1em 0 0.4em;
  font-size: 1em;
  font-weight: 600;
  line-height: 1.5;
  color: var(--muted);
}
/* 任务列表（GFM） */
.preview-body ul.task-list, .preview-body ol.task-list { list-style: none; padding-left: 1.2em; }
.preview-body li.task-list-item { list-style: none; }
.preview-body input.task-list-item-checkbox { margin-right: .5em; vertical-align: middle; }
.preview p {
  margin: 1em 0;
  text-align: justify;
  text-justify: inter-character;
}
/* 预览模式代码样式在后面统一定义，这里暂时保留基础样式 */
.preview blockquote {
  border-left: 4px solid var(--border-strong);
  margin: 1.2em 0;
  padding: 0.8em 1.2em;
  background: rgba(127,127,127,0.04);
  border-radius: 0 8px 8px 0;
  color: var(--fg);
  font-style: italic;
  box-shadow: 0 1px 4px rgba(0,0,0,0.03);
}
.preview blockquote p {
  margin: 0.4em 0;
}
.preview blockquote p:first-child {
  margin-top: 0;
}
.preview blockquote p:last-child {
  margin-bottom: 0;
}
.preview table {
  border-collapse: collapse;
  width: 100%;
  margin: 1.5em 0;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.preview table th {
  border: 1px solid var(--border-strong);
  padding: 12px 16px;
  background: var(--panel-bg);
  font-weight: 600;
  text-align: left;
  color: var(--fg);
}
.preview table td {
  border: 1px solid var(--border);
  padding: 10px 16px;
  transition: background 0.15s ease;
}
.preview table tr:hover td {
  background: rgba(127,127,127,0.03);
}
.preview table tbody tr:nth-child(even) {
  background: rgba(127,127,127,0.02);
}

/* Mermaid 图右上角缩放控件 */
.mmd-figure { position: relative; display: block; }
.mmd-figure > svg { display: block; }
.mmd-tools {
  position: absolute;
  top: 6px; right: 6px;
  display: inline-flex;
  flex-direction: column;
  gap: 4px;
  padding: 2px;
  border-radius: 6px;
  background: rgba(40,40,40,0.55);
  border: 1px solid rgba(255,255,255,0.25);
  color: #fff;
  z-index: 2;
  pointer-events: none;
  backdrop-filter: blur(2px);
  opacity: 0;
  transition: opacity .15s ease;
}
.mmd-figure:hover .mmd-tools { opacity: 1; pointer-events: auto; }
.mmd-tools .tools-row { display: inline-flex; gap: 4px; justify-content: flex-end; }
.mmd-tools button {
  min-width: 20px; height: 20px;
  padding: 0 6px;
  border: none;
  border-radius: 4px;
  background: transparent;
  color: #fff;
  font-size: 12px; line-height: 1;
  cursor: pointer;
}
.mmd-tools button:hover { background: rgba(255,255,255,0.12); }
.mmd-tools button:active { background: rgba(255,255,255,0.18); }
/* 列表样式优化 */
.preview ul,
.preview ol {
  margin: 1em 0;
  padding-left: 2em;
  line-height: 1.8;
}
.preview li {
  margin: 0.4em 0;
}
.preview ul ul,
.preview ol ol,
.preview ul ol,
.preview ol ul {
  margin: 0.3em 0;
}

/* 链接样式 */
.preview a {
  color: #2563eb;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: all 0.2s ease;
  font-weight: 500;
}
.preview a:hover {
  color: #1e40af;
  border-bottom-color: #1e40af;
}
@media (prefers-color-scheme: dark) {
  .preview a {
    color: #60a5fa;
  }
  .preview a:hover {
    color: #93c5fd;
    border-bottom-color: #93c5fd;
  }
}

/* 图片样式优化 */
.preview img {
  display: block;
  margin: 1.5em auto;
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.preview img:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
}
.preview img:not([width]):not([height]) { max-width: 70%; height: auto; }

/* 分割线样式 */
.preview hr {
  border: none;
  height: 2px;
  background: linear-gradient(to right, transparent, var(--border-strong), transparent);
  margin: 2em 0;
  opacity: 0.6;
}

/* 最近文件 面板 */
.recent-panel {
  position: absolute;
  top: 38px;
  left: 10px;
  min-width: 280px;
  max-width: 520px;
  max-height: 260px;
  overflow: auto;
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  z-index: 20;
}
.recent-panel.hidden { display: none; }
.recent-panel .empty { padding: 10px 12px; color: var(--muted); font-size: 12px; }
.recent-panel .item { padding: 8px 12px; cursor: pointer; font-size: 13px; }
.recent-panel .item:hover { background: rgba(127,127,127,0.08); }
.recent-panel .path { font-size: 11px; color: var(--muted); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* 关于 弹窗 */
.about-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.35);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
  animation: fadeIn 0.2s ease;
  backdrop-filter: blur(4px);
}
.about-overlay.hidden {
  display: none;
}
.about-dialog {
  width: 460px;
  max-width: calc(100% - 40px);
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 12px 36px rgba(0,0,0,0.2);
  animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* 主题面板 */
.theme-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  min-width: 520px;
  max-width: 680px;
  max-height: 80vh;
  overflow: auto;
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,.1);
  z-index: 40;
  padding: 0;
  animation: theme-panel-slidein 0.25s ease-out;
  scrollbar-width: thin;
  scrollbar-color: rgba(127,127,127,0.3) transparent;
}

@keyframes theme-panel-slidein {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.theme-panel::-webkit-scrollbar { width: 8px; }
.theme-panel::-webkit-scrollbar-track { background: transparent; }
.theme-panel::-webkit-scrollbar-thumb { background: rgba(127,127,127,0.3); border-radius: 4px; }
.theme-panel::-webkit-scrollbar-thumb:hover { background: rgba(127,127,127,0.5); }

.theme-panel.hidden { display: none; }

/* 主题面板标题栏 */
.theme-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  border-bottom: 1px solid rgba(127,127,127,0.12);
  background: rgba(127,127,127,0.02);
  border-radius: 12px 12px 0 0;
  position: sticky;
  top: 0;
  z-index: 1;
  backdrop-filter: blur(8px);
}

.theme-panel-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--fg);
  letter-spacing: 0.3px;
}

.theme-panel-close {
  width: 28px;
  height: 28px;
  border: none;
  background: rgba(127,127,127,0.08);
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--fg);
  opacity: 0.6;
  transition: all 0.15s ease;
}

.theme-panel-close:hover {
  opacity: 1;
  background: rgba(127,127,127,0.15);
}

.theme-panel-close svg {
  width: 14px;
  height: 14px;
}

/* 主题面板内容区 */
.theme-panel-content {
  padding: 16px 20px 20px;
}

.theme-section {
  margin: 0 0 14px 0;
  padding: 12px 14px;
  background: rgba(127,127,127,0.03);
  border-radius: 10px;
  border: 1px solid rgba(127,127,127,0.08);
}

.theme-section:last-child {
  margin-bottom: 0;
}

.theme-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--fg);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.9;
}

.theme-swatches {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.theme-swatch {
  width: 28px;
  height: 24px;
  border-radius: 7px;
  cursor: pointer;
  border: 2px solid var(--border);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}

.theme-swatch:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.theme-swatch.active {
  outline: 3px solid #2563eb;
  outline-offset: 2px;
  transform: scale(1.1);
}

.theme-option {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(127,127,127,0.1);
}

.theme-checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-size: 13px;
  color: var(--fg);
  user-select: none;
}

.theme-checkbox {
  cursor: pointer;
  width: 16px;
  height: 16px;
  accent-color: #2563eb;
}

.theme-checkbox-label:hover {
  opacity: 0.8;
}

/* 专注模式开关样式 */
.theme-focus-section {
  padding-bottom: 14px;
  margin-bottom: 14px;
  border-bottom: 1px solid rgba(127,127,127,0.15);
}

.theme-focus-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.theme-toggle-label {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  user-select: none;
  width: 100%;
}

.theme-toggle-label.theme-toggle-half {
  width: calc(50% - 4px);
  gap: 8px;
}

.theme-toggle-label.theme-toggle-third {
  width: calc(33.33% - 5px);
  gap: 4px;
}

.theme-toggle-label.theme-toggle-half .theme-toggle-text {
  font-size: 13px;
}

.theme-toggle-label.theme-toggle-third .theme-toggle-text {
  font-size: 12px;
}

.theme-toggle-label.theme-toggle-boxed {
  background: rgba(127, 127, 127, 0.05);
  border: 1px solid rgba(127, 127, 127, 0.15);
  border-radius: 8px;
  padding: 10px 12px;
  transition: all 0.2s ease;
}

.theme-toggle-label.theme-toggle-boxed:hover {
  background: rgba(127, 127, 127, 0.08);
  border-color: rgba(127, 127, 127, 0.25);
}

.theme-toggle-label.theme-toggle-half .theme-toggle-shortcut {
  font-size: 11px;
  opacity: 0.6;
  margin-left: 4px;
}

.theme-toggle-text {
  font-size: 14px;
  font-weight: 500;
  color: var(--fg);
}

.theme-toggle-switch {
  position: relative;
  width: 44px;
  height: 24px;
  flex-shrink: 0;
}

.theme-toggle-input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

.theme-toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(127,127,127,0.3);
  border-radius: 24px;
  transition: all 0.3s ease;
}

.theme-toggle-slider::before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.theme-toggle-input:checked + .theme-toggle-slider {
  background-color: #2563eb;
}

.theme-toggle-input:checked + .theme-toggle-slider::before {
  transform: translateX(20px);
}

.theme-toggle-input:focus + .theme-toggle-slider {
  box-shadow: 0 0 0 2px rgba(37,99,235,0.3);
}

.theme-toggle-shortcut {
  font-size: 11px;
  color: rgba(127,127,127,0.7);
  background: rgba(127,127,127,0.1);
  padding: 3px 8px;
  border-radius: 4px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  margin-left: auto;
}

.theme-typos {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.theme-typos .typo-btn {
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.theme-typos .typo-btn:hover {
  background: rgba(127,127,127,0.08);
  transform: translateY(-1px);
}

.theme-typos .typo-btn.active {
  background: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

.theme-md {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.theme-md .md-btn {
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.theme-md .md-btn:hover {
  background: rgba(127,127,127,0.08);
  transform: translateY(-1px);
}

.theme-md .md-btn.active {
  background: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

/* 主题面板：字体选择区域 */
.theme-fonts {
  display: grid;
  grid-template-columns: 72px 1fr;
  column-gap: 10px;
  row-gap: 10px;
  align-items: center;
}

.theme-fonts label {
  font-size: 12px;
  font-weight: 500;
  color: var(--fg);
  opacity: 0.85;
}

.theme-fonts select {
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 12px;
  transition: all 0.2s ease;
  cursor: pointer;
}

.theme-fonts select:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}

.theme-fonts .font-install,
.theme-fonts .font-reset {
  justify-self: start;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 8px;
  padding: 5px 12px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.theme-fonts .font-actions {
  grid-column: 2;
  display: flex;
  gap: 8px;
}

.theme-fonts .font-install:hover,
.theme-fonts .font-reset:hover {
  background: rgba(127,127,127,0.08);
  transform: translateY(-1px);
}

/* 响应式设计 - 主题面板 */
@media (max-width: 640px) {
  .theme-panel {
    min-width: 320px;
    max-width: calc(100% - 40px);
    padding: 16px;
  }

  .theme-section {
    padding: 12px;
  }

  .theme-title {
    font-size: 12px;
  }

  .theme-swatch {
    width: 28px;
    height: 24px;
  }

  .theme-typos .typo-btn,
  .theme-md .md-btn {
    padding: 6px 12px;
    font-size: 12px;
  }

  .theme-fonts {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .theme-fonts label {
    font-weight: 600;
  }
}

/* 暗色模式优化 - 主题面板 */
@media (prefers-color-scheme: dark) {
  .theme-panel {
    box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 0 1px rgba(255,255,255,.05);
  }

  .theme-section {
    background: rgba(127,127,127,0.05);
    border-color: rgba(127,127,127,0.1);
  }

  .theme-swatch {
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
}

/* 主题排版：经典衬线 */
.container.typo-serif .preview-body,
.container.typo-serif.wysiwyg-v2 .ProseMirror {
  font-family: var(--font-body, Georgia, 'Times New Roman', Times, 'Source Han Serif SC', serif);
  font-size: 17px;
  line-height: 1.85;
  letter-spacing: 0.005em;
}
.container.typo-serif .preview-body h1,
.container.typo-serif .preview-body h2 { letter-spacing: 0; }
.container.typo-serif .preview-body h1 { font-size: 2.3em; }
.container.typo-serif .preview-body h2 { font-size: 1.9em; }
.container.typo-serif .preview-body blockquote { font-style: italic; background: rgba(127,127,127,0.05); }

/* 主题排版：现代紧凑 */
.container.typo-modern .preview-body,
.container.typo-modern.wysiwyg-v2 .ProseMirror {
  font-family: var(--font-body, Inter, Roboto, 'Noto Sans', system-ui, -apple-system, Segoe UI, Arial, sans-serif);
  font-size: 15.5px;
  line-height: 1.7;
}
.container.typo-modern .preview-body h1,
.container.typo-modern .preview-body h2 { border-bottom: none; }
.container.typo-modern .preview-body h1 { font-size: 2em; font-weight: 800; }
.container.typo-modern .preview-body h2 { font-size: 1.6em; font-weight: 700; }
.container.typo-modern .preview-body hr { opacity: 0.5; height: 1px; }

/* 主题排版：阅读增强（更大字号/行距） */
.container.typo-reading .preview-body,
.container.typo-reading.wysiwyg-v2 .ProseMirror {
  font-size: 17.5px;
  line-height: 1.9;
  letter-spacing: 0.005em;
}
.container.typo-reading .preview-body p,
.container.typo-reading.wysiwyg-v2 .ProseMirror p { margin: 1.05em 0; }

/* 主题排版：学术风（衬线 + 适度行距 + 较明显标题层级） */
.container.typo-academic .preview-body,
.container.typo-academic.wysiwyg-v2 .ProseMirror {
  font-family: var(--font-body, Cambria, Georgia, 'Times New Roman', Times, 'Source Han Serif SC', serif);
  font-size: 16.5px;
  line-height: 1.85;
}
.container.typo-academic .preview-body h1 { font-size: 2.4em; font-weight: 700; }
.container.typo-academic .preview-body h2 { font-size: 2.0em; font-weight: 700; }
.container.typo-academic .preview-body h3 { font-size: 1.6em; font-weight: 600; }
.container.typo-academic .preview-body blockquote { border-left-width: 5px; }

/* 主题排版：紧凑风格（更小字号、更紧凑的行距） */
.container.typo-compact .preview-body,
.container.typo-compact.wysiwyg-v2 .ProseMirror {
  font-size: 14px;
  line-height: 1.6;
  letter-spacing: 0;
}
.container.typo-compact .preview-body p,
.container.typo-compact.wysiwyg-v2 .ProseMirror p { margin: 0.7em 0; }
.container.typo-compact .preview-body h1 { font-size: 1.8em; margin: 0.8em 0 0.5em; }
.container.typo-compact .preview-body h2 { font-size: 1.5em; margin: 0.7em 0 0.4em; }
.container.typo-compact .preview-body h3 { font-size: 1.25em; margin: 0.6em 0 0.3em; }
.container.typo-compact .preview-body ul,
.container.typo-compact .preview-body ol { margin: 0.5em 0; }
.container.typo-compact .preview-body li { margin: 0.25em 0; }

/* 主题排版：优雅风格（大间距、精致衬线） */
.container.typo-elegant .preview-body,
.container.typo-elegant.wysiwyg-v2 .ProseMirror {
  font-family: var(--font-body, 'Playfair Display', Georgia, 'Source Han Serif SC', serif);
  font-size: 17px;
  line-height: 2;
  letter-spacing: 0.01em;
}
.container.typo-elegant .preview-body p,
.container.typo-elegant.wysiwyg-v2 .ProseMirror p { margin: 1.3em 0; }
.container.typo-elegant .preview-body h1 { font-size: 2.5em; font-weight: 500; letter-spacing: -0.02em; }
.container.typo-elegant .preview-body h2 { font-size: 2em; font-weight: 500; letter-spacing: -0.01em; }
.container.typo-elegant .preview-body h3 { font-size: 1.5em; font-weight: 500; }
.container.typo-elegant .preview-body blockquote { font-style: italic; border-left: 2px solid rgba(127,127,127,0.3); }
.container.typo-elegant .preview-body hr { border: none; height: 1px; background: linear-gradient(90deg, transparent, rgba(127,127,127,0.3), transparent); }

/* 主题排版：极简风格（无装饰、干净利落） */
.container.typo-minimal .preview-body,
.container.typo-minimal.wysiwyg-v2 .ProseMirror {
  font-family: var(--font-body, -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif);
  font-size: 15px;
  line-height: 1.75;
}
.container.typo-minimal .preview-body h1,
.container.typo-minimal .preview-body h2 { border-bottom: none; padding-bottom: 0; font-weight: 600; }
.container.typo-minimal .preview-body h1 { font-size: 1.75em; }
.container.typo-minimal .preview-body h2 { font-size: 1.4em; }
.container.typo-minimal .preview-body h3 { font-size: 1.15em; font-weight: 600; }
.container.typo-minimal .preview-body blockquote { border-left: 2px solid #e5e7eb; background: transparent; padding: 0.5em 1em; }
.container.typo-minimal .preview-body pre { border-radius: 4px; }
.container.typo-minimal .preview-body :not(pre) > code { background: #f3f4f6; border: none; }

/* Markdown 风格：GitHub 风（轻微调整以更接近 GitHub 渲染） */
.container.md-github .preview h1,
.container.md-github .preview h2 { border-bottom-color: #e5e7eb; }
.container.md-github .preview pre { background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; box-shadow: none; }
.container.md-github .preview :not(pre) > code { background: #f6f8fa; border: 1px solid #d0d7de; color: #24292f; border-radius: 4px; }
.container.md-github .preview table { border-collapse: collapse; }
.container.md-github .preview table th,
.container.md-github .preview table td { border: 1px solid #d0d7de; padding: 10px 14px; }
.container.md-github .preview table th { background: #f6f8fa; font-weight: 600; }
.container.md-github .preview table tbody tr:nth-child(even) { background: #fafbfc; }
.container.md-github .preview table tbody tr:hover td { background: #f0f3f6; }

/* Markdown 风格：Notion 风（无标题下边线、极简块引用、柔和分割线） */
.container.md-notion .preview h1,
.container.md-notion .preview h2 { border-bottom: none; padding-bottom: 0; }
.container.md-notion .preview h1 { font-weight: 800; letter-spacing: -0.01em; }
.container.md-notion .preview h2 { font-weight: 700; }
.container.md-notion .preview blockquote { border-left: 3px solid #e5e7eb; background: transparent; padding-top: 0.6em; padding-bottom: 0.6em; }
.container.md-notion .preview hr { height: 1px; opacity: 0.4; background: #e5e7eb; }
.container.md-notion .preview ul, .container.md-notion .preview ol { line-height: 1.7; }
.container.md-notion .preview table th { background: rgba(127,127,127,0.06); }
.container.md-notion .preview pre { background: #f7f6f3; border: none; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.06); --code-pre-pad-y: 16px; }
.container.md-notion .preview :not(pre) > code { background: #f3f2ef; border: none; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04); border-radius: 6px; }
.container.md-notion .preview table { border-collapse: separate; border-spacing: 0; border: 1px solid rgba(0,0,0,0.06); border-radius: 6px; overflow: hidden; }
.container.md-notion .preview table th,
.container.md-notion .preview table td { border-bottom: 1px solid rgba(0,0,0,0.06); border-right: 1px solid rgba(0,0,0,0.06); padding: 10px 14px; }
.container.md-notion .preview table tr:last-child td { border-bottom: none; }
.container.md-notion .preview table tr td:last-child, .container.md-notion .preview table tr th:last-child { border-right: none; }
.container.md-notion .preview table tbody tr:hover td { background: rgba(0,0,0,0.03); }

/* Markdown 风格：出版风（更大段落间距、首行缩进、优雅分隔） */
.container.md-journal .preview-body p { margin: 1.2em 0; text-indent: 2em; }
.container.md-journal .preview pre, .container.md-journal .preview blockquote { margin: 1.4em 0; }
.container.md-journal .preview blockquote { border-left: 4px solid var(--border-strong); background: rgba(127,127,127,0.04); }
.container.md-journal .preview hr { height: 2px; opacity: 0.35; background: linear-gradient(to right, transparent, var(--border-strong), transparent); }
.container.md-journal .preview pre { background: #fffdf7; border: 1px dashed #e2d6c2; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); --code-pre-pad-y: 18px; }
.container.md-journal .preview :not(pre) > code { background: #fffaf2; border: 1px dashed #eadfcf; border-radius: 6px; }
.container.md-journal .preview table { border-collapse: separate; border-spacing: 0; }
.container.md-journal .preview table th,
.container.md-journal .preview table td { border-bottom: 1px solid rgba(120,90,40,0.18); border-right: none; padding: 12px 16px; }
.container.md-journal .preview table th { text-transform: none; font-weight: 600; background: rgba(120,90,40,0.06); }
.container.md-journal .preview table tr:last-child td { border-bottom: none; }
.container.md-journal .preview table tbody tr:nth-child(odd) { background: rgba(120,90,40,0.03); }

/* 覆盖阅读模式默认代码样式：确保各风格在阅读模式下也明显区分 */
.container.md-github:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #f6f8fa; border-color: #d0d7de; }
.container.md-notion:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #f7f6f3; border: none; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }
.container.md-journal:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #fffdf7; border: 1px dashed #e2d6c2; }

/* 所见 V2 对应的代码与表格风格（尽量与预览保持一致） */
.container.md-github.wysiwyg-v2 .ProseMirror pre { background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; box-shadow: none; --code-pre-pad-y: 20px; padding: var(--code-pre-pad-y); }
.container.md-github.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 4px; }
.container.md-notion.wysiwyg-v2 .ProseMirror pre { background: #f7f6f3; border: none; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.06); --code-pre-pad-y: 16px; padding-left: 18px; padding-right: 18px; padding-bottom: var(--code-pre-pad-y); }
.container.md-notion.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f3f2ef; border: none; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04); border-radius: 6px; }
.container.md-journal.wysiwyg-v2 .ProseMirror pre { background: #fffdf7; border: 1px dashed #e2d6c2; border-radius: 10px; --code-pre-pad-y: 18px; padding-left: 20px; padding-right: 20px; padding-bottom: var(--code-pre-pad-y); }
.container.md-journal.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #fffaf2; border: 1px dashed #eadfcf; border-radius: 6px; }
.container.md-notion.wysiwyg-v2 .ProseMirror table { border: 1px solid rgba(0,0,0,0.06); border-radius: 6px; overflow: hidden; }
.container.md-notion.wysiwyg-v2 .ProseMirror th,
.container.md-notion.wysiwyg-v2 .ProseMirror td { border-bottom: 1px solid rgba(0,0,0,0.06); border-right: 1px solid rgba(0,0,0,0.06); }
.container.md-notion.wysiwyg-v2 .ProseMirror tr td:last-child, .container.md-notion.wysiwyg-v2 .ProseMirror tr th:last-child { border-right: none; }
.container.md-journal.wysiwyg-v2 .ProseMirror th,
.container.md-journal.wysiwyg-v2 .ProseMirror td { border-bottom: 1px solid rgba(120,90,40,0.18); border-right: none; }
.container.md-journal.wysiwyg-v2 .ProseMirror tr:last-child td { border-bottom: none; }

/* Markdown 风格：Docs（Google Docs 风）- 扁平、弱边界、高可读 */
.container.md-docs .preview h1,
.container.md-docs .preview h2 { border-bottom: none; padding-bottom: 0; }
.container.md-docs .preview h1 { font-weight: 700; letter-spacing: -0.01em; }
.container.md-docs .preview h2 { font-weight: 600; }
.container.md-docs .preview pre { background: #fafcff; border: 1px solid #e4e9f2; border-radius: 6px; --code-pre-pad-y: 18px; box-shadow: none; }
.container.md-docs .preview :not(pre) > code { background: #f2f4f8; border: 1px solid #e4e9f2; border-radius: 4px; }
.container.md-docs .preview table { border-collapse: collapse; }
.container.md-docs .preview th,
.container.md-docs .preview td { border: 1px solid #e4e9f2; padding: 10px 14px; }
.container.md-docs .preview th { background: #f7f9fc; font-weight: 600; }
.container.md-docs .preview tbody tr:nth-child(even) { background: #fbfcfe; }

/* 所见 V2 Docs 对应 */
.container.md-docs.wysiwyg-v2 .ProseMirror pre { background: #fafcff; border: 1px solid #e4e9f2; border-radius: 6px; --code-pre-pad-y: 18px; padding: var(--code-pre-pad-y) 18px; }
.container.md-docs.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f2f4f8; border: 1px solid #e4e9f2; border-radius: 4px; }
.container.md-docs.wysiwyg-v2 .ProseMirror th,
.container.md-docs.wysiwyg-v2 .ProseMirror td { border: 1px solid #e4e9f2; }
.container.md-docs.wysiwyg-v2 .ProseMirror th { background: #f7f9fc; }
/* Docs 风代码高亮色盘（清晰但不过度鲜艳） */
.container.md-docs { --c-key: #1d4ed8; --c-str: #0d9488; --c-num: #ea580c; --c-fn: #7c3aed; --c-com: #6b7280; }

@media (prefers-color-scheme: dark) {
  .container.md-docs .preview pre { background: #0f1217; border-color: #202733; }
  .container.md-docs .preview :not(pre) > code { background: #12161c; border-color: #202733; }
  .container.md-docs .preview th,
  .container.md-docs .preview td { border-color: #202733; }
  .container.md-docs .preview th { background: #141922; }
  .container.md-docs { --c-key: #93c5fd; --c-str: #5eead4; --c-num: #fdba74; --c-fn: #d8b4fe; --c-com: #9ca3af; }

  .container.md-docs.wysiwyg-v2 .ProseMirror pre { background: #0f1217; border-color: #202733; }
  .container.md-docs.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #12161c; border-color: #202733; }
  .container.md-docs.wysiwyg-v2 .ProseMirror th,
  .container.md-docs.wysiwyg-v2 .ProseMirror td { border-color: #202733; }
  .container.md-docs.wysiwyg-v2 .ProseMirror th { background: #141922; }
}

/* Markdown 风格：卡片风（Card）- 强化卡片化信息密度 */
.container.md-card .preview h1,
.container.md-card .preview h2 { border-bottom-color: rgba(0,0,0,0.06); }
.container.md-card .preview pre { background: #ffffff; border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; box-shadow: 0 4px 14px rgba(0,0,0,0.08); --code-pre-pad-y: 18px; }
.container.md-card .preview :not(pre) > code { background: #f7f7f7; border: 1px solid rgba(0,0,0,0.08); border-radius: 6px; }
.container.md-card .preview table { border-collapse: separate; border-spacing: 0; border: 1px solid rgba(0,0,0,0.08); border-radius: 10px; overflow: hidden; }
.container.md-card .preview th,
.container.md-card .preview td { border-bottom: 1px solid rgba(0,0,0,0.06); padding: 12px 16px; }
.container.md-card .preview th { background: #f8fafc; font-weight: 600; }
.container.md-card .preview tr:last-child td { border-bottom: none; }
.container.md-card .preview tbody tr:hover td { background: rgba(0,0,0,0.03); }
/* 卡片风代码高亮色盘（更鲜明） */
.container.md-card { --c-key: #2563eb; --c-str: #16a34a; --c-num: #d97706; --c-fn: #7c3aed; --c-com: #64748b; }

/* Markdown 风格：终端风（已移除） */

/* Markdown 风格：Typora 风（简洁优雅、强调内容） */
.container.md-typora .preview h1,
.container.md-typora .preview h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
.container.md-typora .preview h1 { font-size: 2em; font-weight: 600; }
.container.md-typora .preview h2 { font-size: 1.5em; font-weight: 600; }
.container.md-typora .preview pre { background: #f6f8fa; border: none; border-radius: 3px; box-shadow: none; }
.container.md-typora .preview :not(pre) > code { background: #f3f4f6; border: none; border-radius: 3px; padding: 0.2em 0.4em; color: #e83e8c; }
.container.md-typora .preview blockquote { border-left: 4px solid #dfe2e5; background: transparent; color: #6a737d; }
.container.md-typora .preview table { border-collapse: collapse; }
.container.md-typora .preview th,
.container.md-typora .preview td { border: 1px solid #dfe2e5; padding: 8px 13px; }
.container.md-typora .preview th { background: #f6f8fa; font-weight: 600; }
.container.md-typora .preview hr { height: 2px; background: #e1e4e8; border: none; }
.container.md-typora { --c-key: #d73a49; --c-str: #032f62; --c-num: #005cc5; --c-fn: #6f42c1; --c-com: #6a737d; }

/* Markdown 风格：Obsidian 风（深色调、紫色强调） */
.container.md-obsidian .preview h1,
.container.md-obsidian .preview h2 { border-bottom: none; }
.container.md-obsidian .preview h1 { font-size: 2em; font-weight: 700; color: #7c3aed; }
.container.md-obsidian .preview h2 { font-size: 1.6em; font-weight: 600; color: #6d28d9; }
.container.md-obsidian .preview h3 { font-size: 1.3em; font-weight: 600; color: #5b21b6; }
.container.md-obsidian .preview a { color: #7c3aed; }
.container.md-obsidian .preview a:hover { color: #6d28d9; }
.container.md-obsidian .preview pre { background: #1e1e2e; border: none; border-radius: 6px; }
.container.md-obsidian .preview pre code { color: #cdd6f4; }
.container.md-obsidian .preview :not(pre) > code { background: #f3e8ff; border: none; border-radius: 4px; color: #7c3aed; }
.container.md-obsidian .preview blockquote { border-left: 3px solid #7c3aed; background: rgba(124, 58, 237, 0.05); }
.container.md-obsidian .preview table th { background: rgba(124, 58, 237, 0.1); }
.container.md-obsidian .preview mark { background: #fef08a; }
.container.md-obsidian { --c-key: #cba6f7; --c-str: #a6e3a1; --c-num: #fab387; --c-fn: #89b4fa; --c-com: #6c7086; }

/* Markdown 风格：Bear 风（红色标题、优雅极简） */
.container.md-bear .preview h1,
.container.md-bear .preview h2 { border-bottom: none; padding-bottom: 0; }
.container.md-bear .preview h1 { font-size: 2em; font-weight: 700; color: #e53935; }
.container.md-bear .preview h2 { font-size: 1.5em; font-weight: 600; color: #d32f2f; }
.container.md-bear .preview h3 { font-size: 1.25em; font-weight: 600; color: #c62828; }
.container.md-bear .preview a { color: #e53935; text-decoration: none; }
.container.md-bear .preview a:hover { text-decoration: underline; }
.container.md-bear .preview pre { background: #fafafa; border: 1px solid #f0f0f0; border-radius: 8px; box-shadow: none; }
.container.md-bear .preview :not(pre) > code { background: #fff3e0; border: none; border-radius: 4px; color: #e65100; }
.container.md-bear .preview blockquote { border-left: 3px solid #e53935; background: rgba(229, 57, 53, 0.04); font-style: italic; }
.container.md-bear .preview table { border-collapse: collapse; border-radius: 8px; overflow: hidden; }
.container.md-bear .preview th,
.container.md-bear .preview td { border: 1px solid #f0f0f0; padding: 10px 14px; }
.container.md-bear .preview th { background: #fafafa; font-weight: 600; }
.container.md-bear .preview hr { height: 1px; background: #e0e0e0; border: none; }
.container.md-bear { --c-key: #e53935; --c-str: #43a047; --c-num: #fb8c00; --c-fn: #8e24aa; --c-com: #78909c; }

/* 所见 V2 映射（卡片风、终端风） */
.container.md-card.wysiwyg-v2 .ProseMirror pre { background: #ffffff; border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; box-shadow: 0 4px 14px rgba(0,0,0,0.08); --code-pre-pad-y: 18px; padding: var(--code-pre-pad-y) 20px; }
.container.md-card.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f7f7f7; border: 1px solid rgba(0,0,0,0.08); border-radius: 6px; }
.container.md-card.wysiwyg-v2 .ProseMirror table { border: 1px solid rgba(0,0,0,0.08); border-radius: 10px; overflow: hidden; }
.container.md-card.wysiwyg-v2 .ProseMirror th,
.container.md-card.wysiwyg-v2 .ProseMirror td { border-bottom: 1px solid rgba(0,0,0,0.06); }
.container.md-card.wysiwyg-v2 .ProseMirror tr:last-child td { border-bottom: none; }

.container.md-terminal.wysiwyg-v2 .ProseMirror pre {}
.container.md-terminal.wysiwyg-v2 .ProseMirror pre code {}
.container.md-terminal.wysiwyg-v2 .ProseMirror :not(pre) > code {}
.container.md-terminal.wysiwyg-v2 .ProseMirror th,
.container.md-terminal.wysiwyg-v2 .ProseMirror td {}

/* 所见 V2 映射：Typora 风 */
.container.md-typora.wysiwyg-v2 .ProseMirror pre { background: #f6f8fa; border: none; border-radius: 3px; }
.container.md-typora.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f3f4f6; border: none; border-radius: 3px; color: #e83e8c; }
.container.md-typora.wysiwyg-v2 .ProseMirror blockquote { border-left: 4px solid #dfe2e5; background: transparent; }
.container.md-typora.wysiwyg-v2 .ProseMirror th,
.container.md-typora.wysiwyg-v2 .ProseMirror td { border: 1px solid #dfe2e5; }
.container.md-typora.wysiwyg-v2 .ProseMirror th { background: #f6f8fa; }

/* 所见 V2 映射：Obsidian 风 */
.container.md-obsidian.wysiwyg-v2 .ProseMirror h1 { color: #7c3aed; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror h2 { color: #6d28d9; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror h3 { color: #5b21b6; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror pre { background: #1e1e2e; border: none; border-radius: 6px; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror pre code { color: #cdd6f4; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #f3e8ff; border: none; color: #7c3aed; }
.container.md-obsidian.wysiwyg-v2 .ProseMirror blockquote { border-left: 3px solid #7c3aed; background: rgba(124, 58, 237, 0.05); }
.container.md-obsidian.wysiwyg-v2 .ProseMirror th { background: rgba(124, 58, 237, 0.1); }
.container.md-obsidian.wysiwyg-v2 .ProseMirror a { color: #7c3aed; }

/* 所见 V2 映射：Bear 风 */
.container.md-bear.wysiwyg-v2 .ProseMirror h1 { color: #e53935; }
.container.md-bear.wysiwyg-v2 .ProseMirror h2 { color: #d32f2f; }
.container.md-bear.wysiwyg-v2 .ProseMirror h3 { color: #c62828; }
.container.md-bear.wysiwyg-v2 .ProseMirror pre { background: #fafafa; border: 1px solid #f0f0f0; border-radius: 8px; }
.container.md-bear.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #fff3e0; border: none; color: #e65100; }
.container.md-bear.wysiwyg-v2 .ProseMirror blockquote { border-left: 3px solid #e53935; background: rgba(229, 57, 53, 0.04); }
.container.md-bear.wysiwyg-v2 .ProseMirror th,
.container.md-bear.wysiwyg-v2 .ProseMirror td { border: 1px solid #f0f0f0; }
.container.md-bear.wysiwyg-v2 .ProseMirror th { background: #fafafa; }
.container.md-bear.wysiwyg-v2 .ProseMirror a { color: #e53935; }

@media (prefers-color-scheme: dark) {
  .container.md-card .preview pre { background: #0f1114; border-color: #262a33; box-shadow: 0 6px 20px rgba(0,0,0,0.5); }
  .container.md-card .preview :not(pre) > code { background: #13161a; border-color: #262a33; }
  .container.md-card .preview th { background: #151a1f; }
  .container.md-card .preview td, .container.md-card .preview th { border-color: #262a33; }

  /* 终端风（已移除） */

  .container.md-card.wysiwyg-v2 .ProseMirror pre { background: #0f1114; border-color: #262a33; box-shadow: 0 6px 20px rgba(0,0,0,0.5); }
  .container.md-card.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #13161a; border-color: #262a33; }
  .container.md-terminal.wysiwyg-v2 .ProseMirror pre {}
  .container.md-terminal.wysiwyg-v2 .ProseMirror :not(pre) > code {}
}

@media (prefers-color-scheme: dark) {
  .container.md-github .preview pre { background: #0d1117; border-color: #30363d; }
  .container.md-github .preview :not(pre) > code { background: #161b22; border-color: #30363d; color: #c9d1d9; }
  .container.md-github .preview table th,
  .container.md-github .preview table td { border-color: #30363d; }
  .container.md-github .preview table th { background: #161b22; }
  .container.md-github .preview table tbody tr:nth-child(even) { background: #0f141b; }

  /* 深色主题下，阅读模式的 GitHub 风格代码块/行内代码（与浅色规则同等特异性，避免被覆盖） */
  .container.md-github:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #0d1117; border-color: #30363d; }
  .container.md-github:not(.wysiwyg):not(.wysiwyg-v2) .preview :not(pre) > code { background: #161b22; border-color: #30363d; color: #c9d1d9; }

  .container.md-notion .preview pre { background: #1c1c1a; box-shadow: 0 1px 2px rgba(0,0,0,0.4); }
  .container.md-notion .preview :not(pre) > code { background: #1a1917; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }
  .container.md-notion .preview table { border-color: rgba(255,255,255,0.08); }
  .container.md-notion .preview table th,
  .container.md-notion .preview table td { border-color: rgba(255,255,255,0.08); }
  .container.md-notion .preview table th { background: rgba(255,255,255,0.04); }

  /* 深色主题下，阅读模式的 Notion 风格代码块/行内代码（与浅色规则同等特异性，避免被覆盖） */
  .container.md-notion:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #1c1c1a; box-shadow: 0 1px 2px rgba(0,0,0,0.4); }
  .container.md-notion:not(.wysiwyg):not(.wysiwyg-v2) .preview :not(pre) > code { background: #1a1917; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }

  .container.md-journal .preview pre { background: #141210; border-color: #3a332a; }
  .container.md-journal .preview :not(pre) > code { background: #17130f; border-color: #3a332a; }
  .container.md-journal .preview table th,
  .container.md-journal .preview table td { border-bottom-color: rgba(240,220,180,0.16); }

  /* 深色主题下，阅读模式的 出版风（journal）代码块/行内代码（与浅色规则同等特异性，避免被覆盖） */
  .container.md-journal:not(.wysiwyg):not(.wysiwyg-v2) .preview pre { background: #141210; border-color: #3a332a; }
  .container.md-journal:not(.wysiwyg):not(.wysiwyg-v2) .preview :not(pre) > code { background: #17130f; border-color: #3a332a; }

  .container.md-github.wysiwyg-v2 .ProseMirror pre { background: #0d1117; border-color: #30363d; }
  .container.md-github.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #161b22; border-color: #30363d; color: #c9d1d9; }
  .container.md-notion.wysiwyg-v2 .ProseMirror pre { background: #1c1c1a; box-shadow: 0 1px 2px rgba(0,0,0,0.4); }
  .container.md-notion.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #1a1917; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }
  .container.md-journal.wysiwyg-v2 .ProseMirror pre { background: #141210; border-color: #3a332a; }
  .container.md-journal.wysiwyg-v2 .ProseMirror :not(pre) > code { background: #17130f; border-color: #3a332a; }
}

/* WYSIWYG 对应覆盖（与预览一致的风格） */
.container.md-notion.wysiwyg-v2 .ProseMirror h1,
.container.md-notion.wysiwyg-v2 .ProseMirror h2 { border-bottom: none; padding-bottom: 0; }
.container.md-journal.wysiwyg-v2 .ProseMirror p { margin: 1.2em 0; text-indent: 2em; }
.container.md-journal.wysiwyg-v2 .ProseMirror blockquote { border-left: 4px solid var(--border-strong); background: rgba(127,127,127,0.04); }

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.about-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--border); font-weight: 600; font-size: 14px; }
.about-close { cursor: pointer; border: none; background: transparent; color: var(--muted); font-size: 16px; line-height: 1; padding: 4px; border-radius: 6px; }
.about-close:hover { background: rgba(127,127,127,0.12); }
.about-body { padding: 14px 16px 16px 16px; font-size: 13px; line-height: 1.6; }
.about-body p { margin: 0.4em 0; }
.about-subtitle { margin-top: 10px; font-weight: 600; font-size: 13px; }
.about-shortcuts { margin-top: 8px; display: grid; grid-template-columns: 1fr auto; column-gap: 16px; row-gap: 6px; align-items: center; }
.about-shortcuts .sc-act { color: var(--fg); }
.about-shortcuts .sc-keys { color: var(--muted); }
.about-body kbd { display: inline-block; min-width: 20px; padding: 2px 6px; border: 1px solid var(--border); border-bottom-width: 2px; border-radius: 6px; background: rgba(127,127,127,0.08); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; color: var(--fg); }
.about-footer { display: flex; justify-content: flex-end; align-items: center; gap: 12px; padding: 8px 12px; border-top: 1px solid var(--border); }
.about-footer #about-version { font-size: 12px; color: var(--muted); }
.about-footer a { color: #2563eb; text-decoration: none; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; }
.about-footer a:hover { text-decoration: underline; }
.about-footer .sep { color: var(--muted); font-size: 12px; }
.about-footer .favicon { width: 16px; height: 16px; border-radius: 3px; }

/* 隐藏正文中的关于链接区域（已移至底部右侧） */
.about-body .about-links { display: none; }
.about-links { margin-top: 10px; }
.about-links a { color: #2563eb; text-decoration: none; }
.about-links a:hover { text-decoration: underline; }

/* 插入链接 对话框 */
.link-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; z-index: 60; }
.link-overlay.hidden { display: none; }
.link-dialog { width: 420px; max-width: calc(100% - 40px); background: var(--bg); color: var(--fg); border: 1px solid var(--border); border-radius: 12px; box-shadow: 0 12px 36px rgba(0,0,0,0.2); }
.link-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--border); font-weight: 600; font-size: 14px; }
.link-body { padding: 14px 16px 16px 16px; }
.link-field { display: grid; grid-template-columns: 64px 1fr; align-items: center; gap: 10px; margin: 10px 0; font-size: 13px; }
.link-field span { color: var(--muted); }
.link-field input { width: 100%; padding: 8px 10px; border: 1px solid var(--border); background: var(--bg); color: var(--fg); border-radius: 8px; outline: none; font-size: 13px; min-width: 0; box-sizing: border-box; }
.link-field input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.15); }
.link-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 12px; }
.link-actions button { -webkit-app-region: no-drag; cursor: pointer; border: 1px solid var(--border); background: rgba(127,127,127,0.08); color: var(--fg); border-radius: 8px; padding: 6px 12px; font-size: 13px; }
.link-actions button:hover { background: rgba(127,127,127,0.14); }

/* 图床设置 对话框 */
/* 图床和同步设置弹窗 */
.upl-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 65;
  animation: upl-overlay-fadein 0.2s ease-out;
}
.upl-overlay.hidden { display: none; }

@keyframes upl-overlay-fadein {
  from { opacity: 0; }
  to { opacity: 1; }
}

.upl-dialog {
  width: 680px;
  max-width: calc(100% - 40px);
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,.1);
  animation: upl-dialog-slidein 0.25s ease-out;
  overflow: hidden;
}

@keyframes upl-dialog-slidein {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.upl-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 15px;
  background: linear-gradient(to bottom, rgba(127,127,127,0.02), transparent);
}

.upl-header button {
  border: none;
  background: transparent;
  color: var(--muted);
  cursor: pointer;
  font-size: 20px;
  line-height: 1;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  padding: 0;
}

.upl-header button:hover {
  background: rgba(127,127,127,0.1);
  color: var(--fg);
}

.upl-body {
  padding: 18px 20px 20px;
  max-height: 65vh;
  overflow: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(127,127,127,0.3) transparent;
}
.upl-body::-webkit-scrollbar { width: 8px; }
.upl-body::-webkit-scrollbar-track { background: transparent; }
.upl-body::-webkit-scrollbar-thumb { background: rgba(127,127,127,0.3); border-radius: 4px; }
.upl-body::-webkit-scrollbar-thumb:hover { background: rgba(127,127,127,0.5); }

.upl-grid {
  display: grid;
  grid-template-columns: 130px 1fr;
  align-items: center;
  gap: 12px 14px;
}

.upl-field { display: contents; }

.upl-grid label {
  color: var(--fg);
  font-size: 13px;
  font-weight: 500;
  opacity: 0.85;
}

.upl-grid input[type="text"],
.upl-grid input[type="password"],
.upl-grid input[type="url"],
.upl-grid input[type="number"] {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 10px;
  outline: none;
  font-size: 13px;
  min-width: 0;
  box-sizing: border-box;
  transition: all 0.2s ease;
}

.upl-grid input:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}

.upl-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

.upl-actions button {
  -webkit-app-region: no-drag;
  cursor: pointer;
  border: 1px solid var(--border);
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  border-radius: 10px;
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.upl-actions button:hover:not(:disabled) {
  background: rgba(127,127,127,0.15);
  transform: translateY(-1px);
}

.upl-actions button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* === UI 美化补充（库侧栏与图床设置）=== */
/* 库侧栏：行高、箭头、图标配色与悬停态 */
.library .lib-node { min-height: 26px; gap: 8px; padding: 4px 8px; }
.library .lib-node .lib-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.library .lib-node .lib-tg { width: 14px; height: 14px; color: var(--muted); transition: transform .12s ease; }
.library .lib-node.expanded .lib-tg { transform: rotate(90deg); color: var(--fg); }
.library .lib-ico { width: 16px; height: 16px; color: var(--muted); fill: currentColor; }
.library .lib-node:hover .lib-ico { color: var(--fg); }
.library .lib-ico-folder { color: #f59e0b; } /* 简约点缀色：琥珀 */
@media (prefers-color-scheme: dark) {
  .library .lib-ico-folder { color: #fbbf24; }
}
/* 替换文件图标为简约 SVG，保留旧类避免破坏布局 */
.library .lib-ico-file { width: 14px; height: 16px; display: inline-block; }

/* 树形缩进更柔和 */
.library .lib-children { margin-left: 16px; border-left: 1px dashed rgba(127,127,127,0.2); padding-left: 6px; }

/* 图床设置弹窗：分组与描述、开关样式、提示文案 */
.upl-desc {
  margin: 0 0 12px 0;
  padding: 8px 12px;
  font-size: 12px;
  color: var(--muted);
  background: rgba(127,127,127,0.03);
  border-radius: 8px;
  border-left: 2px solid rgba(37,99,235,0.5);
  line-height: 1.5;
}

.upl-section-title {
  grid-column: 1 / -1;
  margin: 20px 0 12px 0;
  padding-bottom: 8px;
  font-weight: 600;
  font-size: 13px;
  color: var(--fg);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid var(--border);
  opacity: 0.95;
}

.upl-section-title:first-of-type {
  margin-top: 0;
}

.upl-hint {
  grid-column: 2 / -1;
  margin: -8px 0 4px 0;
  font-size: 12px;
  color: var(--muted);
  line-height: 1.5;
}

/* 简约开关（复用 checkbox）*/
.switch {
  position: relative;
  width: 42px;
  height: 24px;
  display: inline-block;
}

.switch input { display: none; }

.switch .trk {
  position: absolute;
  inset: 0;
  background: rgba(127,127,127,0.25);
  border-radius: 999px;
  transition: all 0.2s ease;
  cursor: pointer;
}

.switch .kn {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--bg);
  box-shadow: 0 2px 4px rgba(0,0,0,.2);
  transition: all 0.2s ease;
}

.switch input:checked + .trk {
  background: #2563eb;
}

.switch input:checked + .trk + .kn {
  transform: translateX(18px);
}

.switch:hover .trk {
  opacity: 0.9;
}

/* 操作区按钮语义色 */
.upl-actions .btn-secondary {
  border-color: var(--border);
  background: rgba(127,127,127,0.08);
}

.upl-actions .btn-primary {
  border-color: #2563eb;
  background: #2563eb;
  color: #fff;
}

.upl-actions .btn-primary:hover:not(:disabled) {
  background: #1d4ed8;
  box-shadow: 0 2px 8px rgba(37,99,235,0.3);
}

/* 测试结果 */
#upl-test-result {
  margin-left: auto;
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
  padding: 4px 8px;
  border-radius: 6px;
  transition: all 0.2s ease;
}

#upl-test-result.ok {
  color: #16a34a;
  background: rgba(22,163,74,0.1);
}

#upl-test-result.err {
  color: #dc2626;
  background: rgba(220,38,38,0.1);
}

/* 响应式设计 - 图床和同步窗口 */
@media (max-width: 640px) {
  .upl-dialog {
    width: 100%;
    max-width: calc(100% - 20px);
    border-radius: 12px;
  }

  .upl-header {
    padding: 14px 16px;
    font-size: 14px;
  }

  .upl-body {
    padding: 16px;
  }

  .upl-grid {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .upl-grid label {
    font-weight: 600;
  }

  .upl-section-title {
    font-size: 12px;
    margin: 16px 0 8px 0;
  }

  .upl-hint {
    margin: 0 0 8px 0;
  }

  .upl-actions {
    flex-direction: column-reverse;
  }

  .upl-actions button {
    width: 100%;
  }
}

/* 暗色模式优化 - 图床和同步窗口 */
@media (prefers-color-scheme: dark) {
  .upl-overlay {
    background: rgba(0,0,0,.65);
  }

  .upl-dialog {
    box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 0 1px rgba(255,255,255,.05);
  }

  .upl-desc {
    background: rgba(127,127,127,0.05);
    border-left-color: rgba(59,130,246,0.5);
  }

  .switch .kn {
    box-shadow: 0 2px 4px rgba(0,0,0,.4);
  }
}

/* === 全局滚动控制：去掉窗口级滚动，仅内部滚动 === */
html, body { overflow: hidden; }

/* 扩展管理弹窗 */
.ext-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(4px);
  z-index: 80000;
  animation: ext-overlay-fadein 0.2s ease-out;
}
.ext-overlay.show { display: flex; }

@keyframes ext-overlay-fadein {
  from { opacity: 0; }
  to { opacity: 1; }
}

.ext-dialog {
  width: 900px;
  max-width: calc(100% - 40px);
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,.3), 0 0 0 1px rgba(255,255,255,.1);
  animation: ext-dialog-slidein 0.25s ease-out;
  overflow: hidden;
}

@keyframes ext-dialog-slidein {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.ext-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 24px;
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 15px;
  background: linear-gradient(to bottom, rgba(127,127,127,0.02), transparent);
}

.ext-close {
  border: none;
  background: transparent;
  color: var(--muted);
  cursor: pointer;
  font-size: 20px;
  line-height: 1;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
.ext-close:hover {
  background: rgba(127,127,127,0.1);
  color: var(--fg);
}

.ext-body {
  padding: 20px 24px 24px;
  max-height: 75vh;
  overflow: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(127,127,127,0.3) transparent;
}
.ext-body::-webkit-scrollbar { width: 8px; }
.ext-body::-webkit-scrollbar-track { background: transparent; }
.ext-body::-webkit-scrollbar-thumb { background: rgba(127,127,127,0.3); border-radius: 4px; }
.ext-body::-webkit-scrollbar-thumb:hover { background: rgba(127,127,127,0.5); }

.ext-section {
  margin: 0 0 24px 0;
  padding: 16px;
  background: rgba(127,127,127,0.03);
  border-radius: 12px;
  border: 1px solid rgba(127,127,127,0.08);
}
.ext-section:last-child { margin-bottom: 0; }

.ext-subtitle {
  font-weight: 600;
  font-size: 13px;
  color: var(--fg);
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.ext-market-channel {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-left: 12px;
  font-size: 12px;
  opacity: 0.9;
}

.ext-market-channel-label {
  color: var(--muted);
}

.ext-market-channel-select {
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: rgba(127,127,127,0.06);
  color: var(--fg);
  font-size: 12px;
}
.ext-market-channel-select:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(37,99,235,0.25);
}

.ext-subtitle .btn {
  margin-left: auto;
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  text-transform: none;
  letter-spacing: 0;
  transition: all 0.2s ease;
}
.ext-subtitle .btn:hover:not(:disabled) {
  background: rgba(127,127,127,0.15);
  transform: translateY(-1px);
}
.ext-subtitle .btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ext-install {
  display: flex;
  gap: 10px;
  margin-bottom: 8px;
}

.ext-install input[type="text"] {
  flex: 1;
  padding: 10px 14px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  border-radius: 10px;
  outline: none;
  font-size: 13px;
  min-width: 0;
  box-sizing: border-box;
  transition: all 0.2s ease;
}
.ext-install input[type="text"]:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}

.ext-install button {
  padding: 10px 16px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}
.ext-install button:hover:not(:disabled) {
  background: rgba(127,127,127,0.15);
  transform: translateY(-1px);
}
.ext-install button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.ext-install button.primary {
  border-color: #2563eb;
  background: #2563eb;
  color: #fff;
}
.ext-install button.primary:hover:not(:disabled) {
  background: #1d4ed8;
  box-shadow: 0 4px 12px rgba(37,99,235,0.3);
}

.ext-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.ext-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  transition: all 0.2s ease;
}
.ext-item:hover {
  border-color: rgba(127,127,127,0.3);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transform: translateY(-1px);
}

.ext-item .ext-meta {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 0;
}

.ext-item .ext-name {
  font-size: 14px;
  font-weight: 600;
  position: relative;
  display: flex;
  align-items: center;
  gap: 8px;
}

.ext-item .ext-desc {
  font-size: 12px;
  color: var(--muted);
  line-height: 1.5;
}

.ext-item .ext-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.ext-actions .btn {
  padding: 7px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
  white-space: nowrap;
}
.ext-actions .btn:hover:not(:disabled) {
  background: rgba(127,127,127,0.15);
  transform: translateY(-1px);
}
.ext-actions .btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.ext-actions .btn.primary {
  border-color: #2563eb;
  background: #2563eb;
  color: #fff;
}
.ext-actions .btn.primary:hover:not(:disabled) {
  background: #1d4ed8;
  box-shadow: 0 2px 8px rgba(37,99,235,0.3);
}
.ext-actions .btn.warn {
  border-color: #ef4444;
  color: #ef4444;
  background: rgba(239,68,68,0.08);
}
.ext-actions .btn.warn:hover:not(:disabled) {
  background: rgba(239,68,68,0.15);
  box-shadow: 0 2px 8px rgba(239,68,68,0.2);
}

.ext-empty {
  font-size: 13px;
  color: var(--muted);
  text-align: center;
  padding: 20px;
}

/* 扩展市场加载提示样式 */
.ext-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  gap: 16px;
}

.ext-loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: #2563eb;
  border-radius: 50%;
  animation: ext-spin 0.8s linear infinite;
}

@keyframes ext-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.ext-loading-text {
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
  animation: ext-pulse 1.5s ease-in-out infinite;
}

@keyframes ext-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* 扩展标签样式 */
.ext-tag {
  display: inline-flex;
  align-items: center;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  border: 1px solid currentColor;
  opacity: 0.85;
  transition: all 0.2s ease;
}

/* 扩展可更新的标识 */
.ext-item .ext-update-badge {
  display: inline-flex;
  align-items: center;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 10px;
  font-weight: 600;
  line-height: 1.2;
  border: 1px solid #f97316;
  background: rgba(249,115,22,0.1);
  color: #f97316;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  transition: all 0.2s ease;
}
.ext-item .ext-update-badge:hover {
  background: rgba(249,115,22,0.2);
  transform: scale(1.05);
}

/* 推荐标识样式优化 */
.ext-item .ext-name .ext-tag {
  margin-left: 0;
  padding: 2px 8px;
  font-size: 11px;
}

/* 响应式设计 */
@media (max-width: 640px) {
  .ext-dialog {
    width: 100%;
    max-width: calc(100% - 20px);
    border-radius: 12px;
  }

  .ext-header {
    padding: 14px 16px;
  }

  .ext-body {
    padding: 16px;
  }

  .ext-section {
    padding: 12px;
  }

  .ext-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .ext-item .ext-actions {
    width: 100%;
    justify-content: flex-end;
  }

  .ext-subtitle {
    font-size: 12px;
  }
}

/* 暗色模式优化 */
@media (prefers-color-scheme: dark) {
  .ext-overlay {
    background: rgba(0,0,0,.65);
  }

  .ext-dialog {
    box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 0 1px rgba(255,255,255,.05);
  }

  .ext-section {
    background: rgba(127,127,127,0.05);
    border-color: rgba(127,127,127,0.1);
  }

  .ext-item {
    border-color: rgba(127,127,127,0.2);
  }

  .ext-item:hover {
    border-color: rgba(127,127,127,0.4);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
}

/* 隐藏插件自建的头部条，避免重复顶栏按钮 */
.tp-fly-headbar { display: none !important; }

/* === Markdown 代码渲染主题（简约）=== */
:root {
  --code-bg: #f6f8fa;
  --code-border: #e5e7eb;
  --code-fg: #1f2328;
  --code-muted: #667085;
  --c-key: #7c3aed;   /* 关键字 */
  --c-str: #2563eb;   /* 字符串 */
  --c-num: #059669;   /* 数字 */
  --c-fn:  #db2777;   /* 函数/标题 */
  --c-com: #9ca3af;  /* 注释 */
}
@media (prefers-color-scheme: dark) {
  :root {
    --code-bg: #0f1114;
    --code-border: #1f2937;
    --code-fg: #e5e7eb;
    --code-muted: #9ca3af;
    --c-key: #a78bfa;
    --c-str: #60a5fa;
    --c-num: #34d399;
    --c-fn:  #f472b6;
    --c-com: #6b7280;
  }
}

/* 块级代码 */
.preview pre {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  /* 统一以变量记录代码块上下内边距，便于各风格覆盖时参与计算 */
  --code-pre-pad-y: 20px;
  padding: var(--code-pre-pad-y);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  margin: 16px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  transition: box-shadow 0.2s ease;
}
.preview pre:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.preview pre code {
  display: block;
  background: transparent;
  color: var(--code-fg);
  font-family: var(--font-mono, "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  font-size: 14px;
  line-height: 1.7;
  letter-spacing: 0.02em;
}
/* 行内代码 */
.preview :not(pre) > code {
  background: var(--code-bg);
  color: var(--code-fg);
  border: 1px solid var(--code-border);
  border-radius: 6px;
  padding: 2px 8px;
  font-size: 0.9em;
  font-family: var(--font-mono, "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  font-weight: 500;
}

/* hljs token 颜色（不依赖外部主题）*/
.preview code.hljs .hljs-keyword, .preview code.hljs .hljs-selector-tag { color: var(--c-key); }
.preview code.hljs .hljs-title, .preview code.hljs .hljs-section, .preview code.hljs .hljs-function { color: var(--c-fn); }
.preview code.hljs .hljs-string, .preview code.hljs .hljs-attr, .preview code.hljs .hljs-template-variable { color: var(--c-str); }
.preview code.hljs .hljs-number, .preview code.hljs .hljs-literal, .preview code.hljs .hljs-bullet { color: var(--c-num); }
.preview code.hljs .hljs-comment, .preview code.hljs .hljs-quote { color: var(--c-com); font-style: italic; }

/* 代码滚动条可以保留以保证可用性；如需隐藏，可启用下两行 */
/* .preview pre::-webkit-scrollbar { height: 8px; } */
/* .preview pre::-webkit-scrollbar-thumb { background: rgba(127,127,127,0.35); border-radius: 999px; } */

/* === 代码块装饰：语言角标、行号、复制 === */

.codebox { position: relative; margin: 16px 0; --code-lang-gap: 28px; }
.codebox .code-lang {
  position: absolute;
  top: 14px;
  left: 16px;
  padding: 4px 10px;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background: rgba(127,127,127,0.05);
  color: var(--muted);
  font-size: 11px;
  line-height: 1;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  backdrop-filter: blur(4px);
}
.codebox .code-copy,
#md-wysiwyg-root .overlay-host .ov-codecopy .code-copy {
  position: absolute;
  top: 14px;
  right: 16px;
  padding: 5px 12px;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background: rgba(127,127,127,0.08);
  color: var(--fg);
  font-size: 11px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
  backdrop-filter: blur(4px);
}
.codebox .code-copy:hover,
#md-wysiwyg-root .overlay-host .ov-codecopy .code-copy:hover {
  background: rgba(127,127,127,0.18);
  border-color: var(--fg);
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
#md-wysiwyg-root .overlay-host .ov-codecopy .code-copy {
  position: static;
  top: auto;
  right: auto;
}
.codebox pre { margin: 0; position: relative; /* 让行号层可绝对定位 */   padding-top: calc(var(--code-pre-pad-y, 20px) + var(--code-lang-gap)); /* 给语言角标让位 */
}
/* 行号列：绝对定位在 pre 内部左侧，随内容滚动 */
.codebox .code-lnums {
  position: absolute;
  top: 0; bottom: 0; left: 0;
  width: 3.5em;                /* 预留固定列宽 */
  padding-left: 0.6em;         /* 数字向内缩进，贴齐左侧 */
  padding-top: calc(var(--code-pre-pad-y, 20px) + var(--code-lang-gap)) !important; /* 强制与pre的padding-top一致，不使用JS计算 */
  box-sizing: border-box;
  color: var(--code-muted);
  /* 所有影响行高的属性必须与代码完全一致 */
  font-size: 14px !important;
  line-height: 1.8 !important; /* 与代码行高一致(1.8)，避免累积误差 */
  letter-spacing: 0.02em;      /* 与代码字符间距一致，避免累积误差 */
  font-family: var(--font-mono, "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
  font-variant-numeric: tabular-nums; /* 等宽数字，纵向对齐更整齐 */
  text-align: right;
  pointer-events: none;        /* 不挡操作 */
  z-index: 1;                  /* 低于角标/复制按钮 */
  opacity: 0.7;
  user-select: none;
  border-right: 1px solid var(--code-border);
  padding-right: 0.8em;
}
.codebox .code-lnums .ln { display: block; }
/* 为行号列让出内边距，避免覆盖代码文本 */
.codebox pre { padding-left: calc(20px + 3.5em + 0.8em + 1px);   padding-top: calc(var(--code-pre-pad-y, 20px) + var(--code-lang-gap)); /* 给语言角标让位 */
}
/* 提升角标/复制按钮层级，避免被行号列覆盖 */
.codebox .code-lang, .codebox .code-copy { z-index: 2; }

/* 阅读模式：移除代码块边框，仅保留背景，不要出现内部横向分隔线 */
.container:not(.wysiwyg) .preview pre { border: none; }

/* 移除阅读模式内所有“横线”式分割视觉（保留背景与内边距） */
.container:not(.wysiwyg) .preview pre * { border: 0 !important; box-shadow: none !important; }

/* === 侧栏文档图标色（按扩展名）=== */
.library .lib-node.file-ext-md .lib-ico-file,
.library .lib-node.file-ext-markdown .lib-ico-file { color: #22c55e; }
.library .lib-node.file-ext-txt .lib-ico-file { color: #64748b; }
.library .lib-node.file-ext-json .lib-ico-file { color: #f59e0b; }
.library .lib-node.file-ext-yml .lib-ico-file,
.library .lib-node.file-ext-yaml .lib-ico-file { color: #38bdf8; }
.library .lib-node.file-ext-js .lib-ico-file { color: #eab308; }
.library .lib-node.file-ext-ts .lib-ico-file { color: #3b82f6; }
.library .lib-node.file-ext-svg .lib-ico-file { color: #8b5cf6; }
.library .lib-node.file-ext-png .lib-ico-file,
.library .lib-node.file-ext-jpg .lib-ico-file,
.library .lib-node.file-ext-jpeg .lib-ico-file,
.library .lib-node.file-ext-gif .lib-ico-file { color: #ec4899; }


/* 程序图标作为文件夹图标 */
.library .lib-ico-app { width: 16px; height: 16px; border-radius: 3px; object-fit: cover; }


/* 库侧栏选中态 */
.library .lib-node.selected { background: rgba(127,127,127,0.16); }


/* FileTree Modals */
#ft-modal { font-size: 13px; }
#ft-modal .ft-box button { cursor: pointer; }

/* 兜底拖拽：跟随鼠标的小浮层（图标+文件名） */
.ft-ghost {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  background: rgba(17, 17, 17, 0.85);
  color: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  pointer-events: none;
  user-select: none;
}

/* 所见模式：覆盖预览背景为专用色 */
.container.wysiwyg .preview { background: var(--wysiwyg-bg); }

/* 所见模式下渲染中：隐藏预览层，避免原始 mermaid 代码短暂闪现 */
.container.wysiwyg .preview.rendering { visibility: hidden; }



/* 所见模式状态条 */
.container.wysiwyg .wysiwyg-status {
  position: absolute; bottom: 12px; right: 12px;
  max-width: 60%;
  background: var(--wysiwyg-status-bg);
  color: var(--fg);
  display: none; align-items: center; gap: 8px;
  padding: 4px 10px; font-size: 12px; z-index: 3;
  border: 1px solid var(--border);
  border-radius: 999px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  pointer-events: none; /* 不遮挡点击编辑 */
}
.container.wysiwyg .wysiwyg-status.show { display: inline-flex; }

/* 所见模式：为状态条让出上内边距 */
.container.wysiwyg .preview { background: var(--wysiwyg-bg); padding-top: 14px; }
.container.wysiwyg .editor { padding-top: 14px; }

/* === 行距优化（代码块）=== */
/* 预览模式：使用舒适的行距以提高可读性 */
.preview pre code { line-height: 1.8 !important; }
/* 所见模式：保持一致的行距 */
.container.wysiwyg .preview pre,
.container.wysiwyg .preview pre code { line-height: 1.6 !important; }

/* WYSIWYG 下的 KaTeX 行内公式在某些字体/缩放下会出现下探溢出，
   导致与下一行内容视觉重叠。仅在所见模式中为 .katex 增加少量底部留白，
   同时提高其行高参与行盒计算，避免与后续文本叠压。*/
.container.wysiwyg .preview .katex {
  display: inline-block;
  vertical-align: baseline;
  line-height: 1.2;          /* 提高自身行高，参与行盒最大值计算 */
  padding-bottom: 0.2em;     /* 增加下边距，给根号等下探元素留出余量 */
}
.container.wysiwyg .preview .katex-display { /* 块级公式也稍作留白，防止与段落挤在一起 */
  margin: 0.6em 0;
}

/* 仅隐藏横向滚动条外观（不影响滚动功能），竖向滚动条保持可见 */
html::-webkit-scrollbar:horizontal,
body::-webkit-scrollbar:horizontal,
#app::-webkit-scrollbar:horizontal,
.container::-webkit-scrollbar:horizontal,
.preview::-webkit-scrollbar:horizontal,
#md-wysiwyg-root::-webkit-scrollbar:horizontal,
.library::-webkit-scrollbar:horizontal { height: 0 !important; }

/* 为主要滚动容器显式展示竖向滚动条（跨浏览器） */
/* Firefox */
.preview, #md-wysiwyg-root, .library {
  scrollbar-width: thin;
  scrollbar-color: rgba(127,127,127,0.4) transparent;
}
/* WebKit/Chromium - 美化滚动条 */
.preview::-webkit-scrollbar:vertical,
#md-wysiwyg-root::-webkit-scrollbar:vertical,
.library::-webkit-scrollbar:vertical {
  width: 12px;
}
.preview::-webkit-scrollbar-thumb,
#md-wysiwyg-root::-webkit-scrollbar-thumb,
.library::-webkit-scrollbar-thumb {
  background: rgba(127,127,127,0.3);
  border-radius: 6px;
  border: 3px solid transparent;
  background-clip: content-box;
  transition: background 0.2s ease;
}
.preview::-webkit-scrollbar-thumb:hover,
#md-wysiwyg-root::-webkit-scrollbar-thumb:hover,
.library::-webkit-scrollbar-thumb:hover {
  background: rgba(127,127,127,0.5);
  background-clip: content-box;
}
.preview::-webkit-scrollbar-track,
#md-wysiwyg-root::-webkit-scrollbar-track,
.library::-webkit-scrollbar-track {
  background: transparent;
  margin: 4px 0;
}
/* WebDAV 同步：标签左对齐、警告缩进与横排开关 */
.upl-grid > label { justify-self: start; text-align: left; }

.upl-hint.warn {
  color: #f59e0b;
  background: rgba(245,158,11,0.1);
  padding: 6px 10px;
  border-radius: 6px;
  margin-top: 4px;
}

.upl-hint.pad-1ch {
  padding: 8px 12px;
  grid-column: 1 / -1;
}

.upl-grid .sync-toggles {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 16px 24px;
  flex-wrap: wrap;
  padding: 12px 16px;
  background: rgba(127,127,127,0.05);
  border-radius: 10px;
  margin: 8px 0;
}

.sync-toggles .item {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}

.sync-toggles .lbl {
  font-size: 13px;
  color: var(--fg);
  font-weight: 500;
  opacity: 0.85;
}

/* === 打印样式 - 确保打印整个文档而不仅是可视范围 === */
@media print {
  /* 隐藏所有UI元素 */
  .titlebar,
  .statusbar,
  .library,
  .recent-panel,
  .wysiwyg-status,
  .wysiwyg-line,
  .wysiwyg-caret,
  .code-copy,
  .code-lang {
    display: none !important;
  }

  /* 移除容器的高度限制，确保打印全部内容 */
  html, body, #app {
    height: auto !important;
    overflow: visible !important;
  }

  .container {
    height: auto !important;
    overflow: visible !important;
    position: static !important;
  }

  /* 预览区域：移除所有限制，显示完整内容 */
  .preview {
    position: static !important;
    overflow: visible !important;
    height: auto !important;
    max-height: none !important;
    padding: 0 !important;
    margin: 0 !important;
    inset: auto !important;
  }

  /* 隐藏编辑器，只打印预览 */
  .editor {
    display: none !important;
  }

  /* 确保预览内容可见 */
  .preview.hidden {
    display: block !important;
  }

  /* 预览正文：移除宽度限制，使用全宽 */
  .preview-body {
    max-width: 100% !important;
    margin: 0 !important;
  }

  /* 确保库侧栏不影响布局 */
  .container.with-library-left .preview,
  .container.with-library-right .preview {
    padding-left: 0 !important;
  }

  /* 代码块：避免分页截断 */
  .preview pre {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* 图片：避免分页截断 */
  .preview img {
    page-break-inside: avoid;
    break-inside: avoid;
    max-width: 100% !important;
  }

  /* 表格：避免分页截断 */
  .preview table {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* 标题：避免孤立在页面底部 */
  .preview h1,
  .preview h2,
  .preview h3,
  .preview h4,
  .preview h5,
  .preview h6 {
    page-break-after: avoid;
    break-after: avoid;
  }

  /* 移除背景色，节省墨水 */
  body, .preview {
    background: white !important;
    color: black !important;
  }

  /* 代码块保持浅色背景以便区分 */
  .preview pre {
    background: #f5f5f5 !important;
    border: 1px solid #ddd !important;
  }

  /* 链接：显示URL */
  .preview a[href]:after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }
}

/* === 额外的视觉增强 === */

/* 按钮通用美化 */
button {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
button:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}
button:active {
  transform: scale(0.98);
}

/* 输入框焦点美化 */
input[type="text"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus {
  outline: none;
}

/* 任务列表复选框美化 */
.preview-body input.task-list-item-checkbox {
  width: 16px;
  height: 16px;
  cursor: pointer;
  accent-color: #2563eb;
  transition: transform 0.15s ease;
}
.preview-body input.task-list-item-checkbox:hover {
  transform: scale(1.1);
}
.preview-body input.task-list-item-checkbox:checked {
  transform: scale(1.05);
}

/* 强调文本样式优化 */
.preview strong,
.preview b {
  font-weight: 700;
  color: var(--fg);
}
.preview em,
.preview i {
  font-style: italic;
  color: var(--fg);
}
.preview mark {
  background: rgba(250, 204, 21, 0.3);
  padding: 2px 4px;
  border-radius: 3px;
}
@media (prefers-color-scheme: dark) {
  .preview mark {
    background: rgba(250, 204, 21, 0.2);
  }
}

/* 删除线文本 */
.preview del,
.preview s {
  text-decoration: line-through;
  opacity: 0.7;
}

/* 键盘按键样式 */
.preview kbd {
  display: inline-block;
  padding: 3px 8px;
  font-size: 0.85em;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  line-height: 1.4;
  color: var(--fg);
  background: var(--code-bg);
  border: 1px solid var(--border-strong);
  border-radius: 6px;
  box-shadow: 0 2px 0 var(--border-strong), 0 1px 2px rgba(0,0,0,0.1);
  white-space: nowrap;
}

/* 注脚样式 */
.preview sup,
.preview sub {
  font-size: 0.75em;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.preview sup {
  top: -0.5em;
}
.preview sub {
  bottom: -0.25em;
}

/* 缩写文本 */
.preview abbr[title] {
  text-decoration: underline dotted;
  cursor: help;
}

/* 平滑滚动 */
.preview,
#md-wysiwyg-root,
.library {
  scroll-behavior: smooth;
}

/* 减少动画偏好设置 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
/* WYSIWYG：单换行视觉一致性（方案A：UI 层） */
.container.wysiwyg-v2 .ProseMirror p,
.container.wysiwyg-v2 .ProseMirror li {
  white-space: pre-line; /* 将换行符渲染为换行，不改变 Markdown 语义 */
}
.container.wysiwyg-v2 .ProseMirror blockquote p {
  white-space: pre-line;
}


/* === 更新弹窗（#update-overlay）定制样式 === */
#update-overlay .link-dialog {
  width: 560px;
  max-width: calc(100% - 48px);
}
#update-overlay .link-header {
  padding: 14px 18px;
}
#update-overlay #update-title {
  font-weight: 700;
}
#update-overlay .link-body {
  padding: 14px 18px 10px 18px;
}
#update-overlay .update-title {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
}
#update-overlay .update-notes {
  max-height: 320px;
  overflow: auto;
  background: rgba(127,127,127,0.06);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
}
@media (prefers-color-scheme: dark) {
  #update-overlay .update-notes {
    background: rgba(255,255,255,0.04);
  }
}
#update-overlay .update-links { margin-top: 8px; padding-left: 18px; }
#update-overlay .update-links a { color: #2563eb; text-decoration: none; }
#update-overlay .update-links a:hover { text-decoration: underline; }

/* 动作区：两个按钮水平居中，距底部保持内边距，不贴底 */
#update-overlay .link-actions {
  justify-content: center;
  gap: 12px;
  margin: 14px 0 16px 0;
  padding: 0;
}

/* 更新弹窗按钮美化（主次按钮） */
#update-overlay .link-actions button {
  border-radius: 999px;
  padding: 8px 16px;
  font-size: 13px;
  border: 1px solid var(--border);
  background: rgba(127,127,127,0.08);
}
#update-overlay .link-actions button.btn-primary {
  color: #fff;
  background: #2563eb;
  border-color: #1d4ed8;
  box-shadow: 0 6px 14px rgba(37,99,235,0.25);
}
#update-overlay .link-actions button.btn-primary:hover {
  background: #1e40af;
}
#update-overlay .link-actions button.btn-secondary {
  background: transparent;
  border-color: var(--border);
}
#update-overlay .link-actions button.btn-secondary:hover {
  background: rgba(127,127,127,0.08);
}
/* 保障标题栏总在最上层，避免被弹窗遮挡 */
.titlebar { position: relative; z-index: 100; }

/* === 查找替换面板样式优化 === */
#find-replace-panel {
  backdrop-filter: blur(12px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08) !important;
  padding: 12px 14px !important;
  min-width: 340px !important;
}

/* 输入框统一样式 */
#find-replace-panel input[type="text"] {
  padding: 7px 10px !important;
  border: 1px solid var(--border-strong) !important;
  border-radius: 8px !important;
  font-size: 13px !important;
  transition: all 0.2s ease !important;
  outline: none !important;
}

#find-replace-panel input[type="text"]:focus {
  border-color: #2563eb !important;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12) !important;
}

#find-replace-panel input[type="text"]::placeholder {
  color: var(--muted);
  opacity: 0.6;
}

/* 区分大小写复选框美化 */
#find-replace-panel label {
  font-size: 12px !important;
  font-weight: 500 !important;
  color: var(--muted) !important;
  cursor: pointer !important;
  padding: 4px 8px !important;
  border-radius: 6px !important;
  transition: all 0.2s ease !important;
  white-space: nowrap !important;
}

#find-replace-panel label:hover {
  background: rgba(127,127,127,0.08) !important;
  color: var(--fg) !important;
}

#find-replace-panel input[type="checkbox"] {
  cursor: pointer !important;
  width: 15px !important;
  height: 15px !important;
  accent-color: #2563eb !important;
}

/* 按钮统一样式 */
#find-replace-panel button {
  padding: 7px 12px !important;
  border: 1px solid var(--border-strong) !important;
  border-radius: 8px !important;
  background: rgba(127,127,127,0.05) !important;
  color: var(--fg) !important;
  font-size: 12px !important;
  font-weight: 500 !important;
  cursor: pointer !important;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
  white-space: nowrap !important;
}

#find-replace-panel button:hover {
  background: rgba(127,127,127,0.12) !important;
  border-color: var(--fg) !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

#find-replace-panel button:active {
  transform: translateY(0) !important;
  box-shadow: 0 1px 2px rgba(0,0,0,0.06) !important;
}

/* 主要操作按钮强调色 */
#find-replace-panel #btn-find-next,
#find-replace-panel #btn-replace-all {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
  color: #fff !important;
  border-color: #1d4ed8 !important;
  font-weight: 600 !important;
}

#find-replace-panel #btn-find-next:hover,
#find-replace-panel #btn-replace-all:hover {
  background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%) !important;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3) !important;
}

/* 关闭按钮特殊样式 */
#find-replace-panel #btn-close-find {
  color: var(--muted) !important;
  border-color: var(--border) !important;
}

#find-replace-panel #btn-close-find:hover {
  color: var(--fg) !important;
  background: rgba(239,68,68,0.08) !important;
  border-color: #ef4444 !important;
}

/* 行间距优化 */
#find-replace-panel > div {
  margin-bottom: 8px !important;
}

#find-replace-panel > div:last-child {
  margin-bottom: 0 !important;
}

/* Ctrl+F 查找模式（隐藏替换功能） */
#find-replace-panel[data-mode="find-only"] #replace-text,
#find-replace-panel[data-mode="find-only"] #btn-replace,
#find-replace-panel[data-mode="find-only"] #btn-replace-all {
  display: none !important;
}

/* Ctrl+F 查找模式下的布局优化 */
#find-replace-panel[data-mode="find-only"] > div:nth-of-type(2) {
  display: inline-flex !important;
  gap: 6px !important;
}

#find-replace-panel[data-mode="find-only"] > div:nth-of-type(3) {
  display: inline-flex !important;
  margin-top: 0 !important;
  margin-left: 8px !important;
}

#find-replace-panel[data-mode="find-only"] #btn-close-find {
  margin-left: 8px !important;
}

/* ========== 夜间模式 ========== */
body.dark-mode {
  --bg: #0b0c0e;
  --fg: #e5e7eb;
  --preview-bg: #12100d;
  --wysiwyg-bg: #0b1016;
  --border: #2d3748;
  --border-strong: #4a5568;
  --muted: #9ca3af;
  --code-bg: #0f1114;
  --code-border: #1f2937;
  --code-fg: #e5e7eb;
}

/* 夜间模式 - 标题栏和菜单 */
body.dark-mode .menubar {
  background: #0f1114 !important;
  border-bottom-color: #2d3748 !important;
}

body.dark-mode .menubar .menu-item,
body.dark-mode .menubar .menu-btn {
  color: #e5e7eb !important;
}

body.dark-mode .menubar .menu-item:hover,
body.dark-mode .menubar .menu-btn:hover {
  background: rgba(255, 255, 255, 0.08) !important;
}

/* 夜间模式 - 侧边栏/库管理 */
body.dark-mode .sidebar,
body.dark-mode .library-sidebar,
body.dark-mode .file-tree,
body.dark-mode [class*="sidebar"],
body.dark-mode [class*="library"],
body.dark-mode [class*="lib-"],
body.dark-mode .left-panel,
body.dark-mode .panel-left,
body.dark-mode [class*="left-panel"],
body.dark-mode [class*="panel-left"],
body.dark-mode .container > div:first-child {
  background: #0f1114 !important;
  border-color: #2d3748 !important;
  color: #e5e7eb !important;
}

body.dark-mode .sidebar-item,
body.dark-mode .tree-item,
body.dark-mode .file-item,
body.dark-mode .folder-item,
body.dark-mode [class*="tree-"] span,
body.dark-mode [class*="file-"] span,
body.dark-mode [class*="library"] span,
body.dark-mode [class*="sidebar"] span {
  color: #e5e7eb !important;
}

body.dark-mode .sidebar-item:hover,
body.dark-mode .tree-item:hover,
body.dark-mode .file-item:hover {
  background: rgba(255, 255, 255, 0.08) !important;
}

body.dark-mode .sidebar-item.active,
body.dark-mode .tree-item.active,
body.dark-mode .file-item.active {
  background: rgba(37, 99, 235, 0.2) !important;
  color: #93c5fd !important;
}

/* 夜间模式 - 库管理按钮和顶部操作栏 */
body.dark-mode .library-actions button,
body.dark-mode [class*="library"] button,
body.dark-mode .sidebar-header button,
body.dark-mode .sidebar-actions button,
body.dark-mode .tree-actions button,
body.dark-mode [class*="sidebar"] button {
  background: transparent !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode .library-actions button:hover,
body.dark-mode [class*="library"] button:hover,
body.dark-mode .sidebar-header button:hover,
body.dark-mode [class*="sidebar"] button:hover {
  background: rgba(255, 255, 255, 0.1) !important;
}

body.dark-mode .library-actions button.active,
body.dark-mode [class*="library"] button.active {
  background: #2563eb !important;
  color: #fff !important;
}

body.dark-mode .library-actions span,
body.dark-mode .sidebar-header span,
body.dark-mode [class*="library"] > span,
body.dark-mode [class*="sidebar-header"] span,
body.dark-mode [class*="library"] span,
body.dark-mode [class*="library"] div,
body.dark-mode [class*="library"] input,
body.dark-mode .library-name,
body.dark-mode .folder-name,
body.dark-mode .current-library,
body.dark-mode [class*="current"] {
  color: #e5e7eb !important;
}

body.dark-mode [class*="library"] input {
  background: transparent !important;
  border-color: #374151 !important;
}

/* 夜间模式 - 库管理顶部标签/输入框 */
body.dark-mode .library-tabs,
body.dark-mode .library-header,
body.dark-mode [class*="library-header"],
body.dark-mode [class*="library-tabs"] {
  background: #0f1114 !important;
  color: #e5e7eb !important;
}

body.dark-mode .library-tabs button,
body.dark-mode .library-header button {
  color: #e5e7eb !important;
}

body.dark-mode .library-tabs button:hover,
body.dark-mode .library-header button:hover {
  background: rgba(255, 255, 255, 0.1) !important;
}

body.dark-mode .library-tabs button.active {
  background: #2563eb !important;
  color: #fff !important;
}

/* 夜间模式 - 所见模式(WYSIWYG/ProseMirror) */
body.dark-mode .ProseMirror,
body.dark-mode .wysiwyg,
body.dark-mode [class*="wysiwyg"] {
  background: #0b1016 !important;
  color: #e5e7eb !important;
}

body.dark-mode .ProseMirror p,
body.dark-mode .ProseMirror h1,
body.dark-mode .ProseMirror h2,
body.dark-mode .ProseMirror h3,
body.dark-mode .ProseMirror h4,
body.dark-mode .ProseMirror h5,
body.dark-mode .ProseMirror h6,
body.dark-mode .ProseMirror li,
body.dark-mode .ProseMirror span {
  color: #e5e7eb !important;
}

body.dark-mode .ProseMirror code {
  background: #1f2937 !important;
  color: #f3f4f6 !important;
}

body.dark-mode .ProseMirror pre {
  background: #0f1114 !important;
  border-color: #2d3748 !important;
}

body.dark-mode .ProseMirror blockquote {
  border-left-color: #4b5563 !important;
  color: #9ca3af !important;
}

body.dark-mode .ProseMirror a {
  color: #60a5fa !important;
}

body.dark-mode .ProseMirror table th,
body.dark-mode .ProseMirror table td {
  border-color: #374151 !important;
  color: #e5e7eb !important;
}

body.dark-mode .ProseMirror table th {
  background: #1f2937 !important;
}

body.dark-mode .ProseMirror hr {
  border-color: #374151 !important;
}

body.dark-mode .ProseMirror img {
  border-color: #374151 !important;
}

/* 夜间模式 - 主题面板 */
body.dark-mode .theme-panel {
  background: #1a1b1e !important;
  border-color: #2d3748 !important;
}

body.dark-mode .theme-panel-header {
  background: rgba(255, 255, 255, 0.03) !important;
  border-bottom-color: rgba(255, 255, 255, 0.08) !important;
}

body.dark-mode .theme-panel-title {
  color: #e5e7eb !important;
}

body.dark-mode .theme-panel-close {
  background: rgba(255, 255, 255, 0.08) !important;
  color: #e5e7eb !important;
}

body.dark-mode .theme-panel-close:hover {
  background: rgba(255, 255, 255, 0.15) !important;
}

body.dark-mode .theme-title,
body.dark-mode .theme-toggle-text {
  color: #e5e7eb !important;
}

body.dark-mode .theme-toggle-label.theme-toggle-boxed {
  background: rgba(255, 255, 255, 0.05) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

body.dark-mode .theme-toggle-label.theme-toggle-boxed:hover {
  background: rgba(255, 255, 255, 0.08) !important;
  border-color: rgba(255, 255, 255, 0.15) !important;
}

body.dark-mode .theme-swatch {
  border-color: #4a5568 !important;
}

body.dark-mode .typo-btn,
body.dark-mode .md-btn {
  background: #1f2937 !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode .typo-btn:hover,
body.dark-mode .md-btn:hover {
  background: #374151 !important;
}

body.dark-mode .typo-btn.active,
body.dark-mode .md-btn.active {
  background: #2563eb !important;
  color: #fff !important;
}

body.dark-mode .theme-fonts select {
  background: #1f2937 !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode .theme-fonts label {
  color: #e5e7eb !important;
}

/* 夜间模式 - 各种弹窗 */
body.dark-mode .modal,
body.dark-mode .dialog,
body.dark-mode [class*="modal"],
body.dark-mode [class*="dialog"],
body.dark-mode [class*="popup"] {
  background: #1a1b1e !important;
  color: #e5e7eb !important;
  border-color: #2d3748 !important;
}

body.dark-mode .modal-header,
body.dark-mode .dialog-header {
  color: #f3f4f6 !important;
  border-bottom-color: #2d3748 !important;
}

body.dark-mode .modal-body,
body.dark-mode .dialog-body {
  color: #e5e7eb !important;
}

/* 夜间模式 - 表单元素 */
body.dark-mode input[type="text"],
body.dark-mode input[type="password"],
body.dark-mode input[type="email"],
body.dark-mode input[type="url"],
body.dark-mode input[type="number"],
body.dark-mode textarea,
body.dark-mode select {
  background: #1f2937 !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode input::placeholder,
body.dark-mode textarea::placeholder {
  color: #6b7280 !important;
}

body.dark-mode input:focus,
body.dark-mode textarea:focus,
body.dark-mode select:focus {
  border-color: #3b82f6 !important;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
}

/* 夜间模式 - 按钮 */
body.dark-mode button:not(.typo-btn):not(.md-btn) {
  background: #1f2937 !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode button:not(.typo-btn):not(.md-btn):hover {
  background: #374151 !important;
}

/* 夜间模式 - 图床设置弹窗 */
body.dark-mode .s3-modal,
body.dark-mode [class*="s3-"],
body.dark-mode [class*="image-host"] {
  background: #1a1b1e !important;
  color: #e5e7eb !important;
}

body.dark-mode .s3-modal h2,
body.dark-mode .s3-modal h3,
body.dark-mode .s3-modal label {
  color: #e5e7eb !important;
}

body.dark-mode .s3-modal .tip,
body.dark-mode .s3-modal .hint,
body.dark-mode .s3-modal small {
  color: #9ca3af !important;
}

/* 夜间模式 - 查找替换面板 */
body.dark-mode #find-replace-panel {
  background: #1a1b1e !important;
  border-color: #2d3748 !important;
}

body.dark-mode #find-replace-panel input {
  background: #1f2937 !important;
  color: #e5e7eb !important;
  border-color: #374151 !important;
}

body.dark-mode #find-replace-panel label {
  color: #e5e7eb !important;
}

/* 夜间模式 - 链接颜色 */
body.dark-mode a {
  color: #60a5fa !important;
}

body.dark-mode a:hover {
  color: #93c5fd !important;
}

/* 夜间模式 - 滚动条 */
body.dark-mode ::-webkit-scrollbar-track {
  background: #1f2937 !important;
}

body.dark-mode ::-webkit-scrollbar-thumb {
  background: #4b5563 !important;
}

body.dark-mode ::-webkit-scrollbar-thumb:hover {
  background: #6b7280 !important;
}

/* 夜间模式 - AI助手窗口 */
body.dark-mode .ai-assistant,
body.dark-mode [class*="ai-"] {
  background: #1a1b1e !important;
  color: #e5e7eb !important;
  border-color: #2d3748 !important;
}

body.dark-mode .ai-assistant input,
body.dark-mode .ai-assistant textarea {
  background: #1f2937 !important;
  color: #e5e7eb !important;
}

/* 夜间模式 - 容器覆盖 */
body.dark-mode .container {
  --bg: #0b0c0e;
  --fg: #e5e7eb;
  --preview-bg: #12100d;
  --wysiwyg-bg: #0b1016;
  background: #0b0c0e !important;
}

/* 夜间模式 - 编辑区域整体背景（包括左右空白） */
body.dark-mode .editor-wrapper,
body.dark-mode .editor-container,
body.dark-mode .edit-pane,
body.dark-mode [class*="editor"],
body.dark-mode [class*="edit-"] {
  background: #0b0c0e !important;
}

/* 夜间模式 - 编辑器 */
body.dark-mode .CodeMirror {
  background: #0b0c0e !important;
  color: #e5e7eb !important;
}

body.dark-mode .CodeMirror-scroll {
  background: #0b0c0e !important;
}

body.dark-mode .CodeMirror-gutters {
  background: #0f1114 !important;
  border-color: #2d3748 !important;
}

body.dark-mode .CodeMirror-linenumber {
  color: #6b7280 !important;
}

body.dark-mode .CodeMirror-cursor {
  border-left-color: #e5e7eb !important;
}

/* 夜间模式 - 预览区域 */
body.dark-mode .preview,
body.dark-mode .preview-body {
  background: #12100d !important;
  color: #e5e7eb !important;
}

body.dark-mode .preview code {
  background: #1f2937 !important;
  color: #f3f4f6 !important;
}

body.dark-mode .preview pre {
  background: #0f1114 !important;
  border-color: #2d3748 !important;
}

body.dark-mode .preview blockquote {
  border-left-color: #4b5563 !important;
  color: #9ca3af !important;
}

body.dark-mode .preview table th,
body.dark-mode .preview table td {
  border-color: #374151 !important;
}

body.dark-mode .preview table th {
  background: #1f2937 !important;
}

body.dark-mode .preview hr {
  border-color: #374151 !important;
}

/* 深色模式优化 */
@media (prefers-color-scheme: dark) {
  #find-replace-panel {
    box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 2px 8px rgba(0,0,0,0.2) !important;
  }

  #find-replace-panel input[type="text"] {
    background: rgba(255,255,255,0.05) !important;
  }

  #find-replace-panel button {
    background: rgba(255,255,255,0.08) !important;
  }

  #find-replace-panel button:hover {
    background: rgba(255,255,255,0.14) !important;
  }
}

/* ============ 右键菜单样式 ============ */
.flymd-context-menu {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  padding: 4px 0;
  min-width: 160px;
  max-width: 280px;
  font-size: 13px;
  overflow: visible;
  animation: context-menu-in 0.15s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes context-menu-in {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(-4px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.context-menu-item {
  display: flex;
  align-items: center;
  padding: 6px 12px;
  cursor: pointer;
  color: var(--fg);
  transition: background-color 0.15s ease;
  position: relative;
  user-select: none;
}

.context-menu-item:hover:not(.disabled) {
  background: var(--panel-bg);
}

.context-menu-item:active:not(.disabled) {
  background: var(--border);
}

.context-menu-item.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.context-menu-icon {
  margin-right: 8px;
  font-size: 14px;
  min-width: 16px;
  text-align: center;
}

.context-menu-label {
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.context-menu-note {
  margin-left: 12px;
  font-size: 11px;
  color: var(--muted);
}

.context-menu-arrow {
  margin-left: 8px;
  font-size: 10px;
  color: var(--muted);
}

.context-menu-divider {
  height: 1px;
  min-height: 1px;
  background: var(--border);
  margin: 4px 0;
}

.context-menu-tip {
  border-top: 1px solid var(--border);
  margin-top: 4px;
  padding: 6px 12px 8px;
  font-size: 11px;
  color: var(--muted);
  line-height: 1.4;
  user-select: none;
}

.context-menu-group {
  padding: 6px 12px 4px;
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  user-select: none;
  min-height: 20px;
}

/* 确保子菜单内的分组和分隔线也能正常显示 */
.context-menu-submenu .context-menu-group {
  /* 继承父级样式 */
}

.context-menu-submenu .context-menu-divider {
  /* 继承父级样式 */
}

/* 子菜单样式 */
.context-menu-item.has-children {
  position: relative;
}

.context-menu-item.has-children > .context-menu-arrow {
  opacity: 0.6;
}

.context-menu-submenu {
  display: none;
  position: absolute;
  left: calc(100% - 4px);
  top: -4px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  padding: 4px 0;
  min-width: 160px;
  min-height: 40px;
  max-width: 280px;
  z-index: 10001;
  pointer-events: auto;
}

/* 向左展开的子菜单 */
.context-menu-submenu.expand-left {
  left: auto;
  right: calc(100% - 4px);
}

/* 父菜单项悬停时显示子菜单 */
.context-menu-item.has-children:hover > .context-menu-submenu {
  display: block;
  animation: context-menu-in 0.15s cubic-bezier(0.16, 1, 0.3, 1);
}

/* 确保子菜单本身悬停时保持显示 */
.context-menu-submenu:hover {
  display: block;
}

/* 深色模式增强 */
@media (prefers-color-scheme: dark) {
  .flymd-context-menu {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
  }

  .context-menu-item:hover:not(.disabled) {
    background: rgba(255, 255, 255, 0.06);
  }

  .context-menu-item:active:not(.disabled) {
    background: rgba(255, 255, 255, 0.1);
  }

  .context-menu-submenu {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
  }
}

/* 拖拽排序样式 */
.flymd-context-menu .context-menu-item.draggable-item {
  cursor: grab;
  transition: background 0.15s ease, opacity 0.15s ease, transform 0.1s ease;
}

.flymd-context-menu .context-menu-item.draggable-item:active {
  cursor: grabbing;
}

/* 拖拽中的菜单项 */
.flymd-context-menu .context-menu-item.dragging {
  opacity: 0.5;
  background: var(--accent-light, rgba(59, 130, 246, 0.15)) !important;
  transform: scale(0.98);
}

/* 拖拽指示器：上方插入 */
.flymd-context-menu .context-menu-item.drag-over-top {
  box-shadow: inset 0 2px 0 0 var(--accent, #3b82f6);
}

/* 拖拽指示器：下方插入 */
.flymd-context-menu .context-menu-item.drag-over-bottom {
  box-shadow: inset 0 -2px 0 0 var(--accent, #3b82f6);
}

/* 拖拽时禁用子菜单展开动画，避免干扰 */
.flymd-context-menu:has(.dragging) .context-menu-submenu {
  transition: none !important;
}

/* ============ 右键菜单样式结束 ============ */

/* ============ 专注模式（Focus Mode）============ */
/* 隐藏顶栏，鼠标悬停顶部边缘时显示 */

/* 专注模式下 #app 需要作为定位上下文 */
body.focus-mode #app {
  position: relative;
}

/* 专注模式下的 titlebar：使用 absolute 脱离文档流 */
body.focus-mode .titlebar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  transform: translateY(-100%);
  opacity: 0;
  pointer-events: none;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

/* 鼠标悬停顶部触发区域或 titlebar 本身时显示 */
body.focus-mode .titlebar.show {
  transform: translateY(0);
  opacity: 1;
  pointer-events: auto;
}

/* 专注模式下容器高度扩展到 100% */
body.focus-mode .container {
  height: 100% !important;
}

/* 顶部触发区域：透明的悬停检测条 */
.focus-trigger-zone {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 8px;
  z-index: 10000;
  pointer-events: none;
  display: none;
}

body.focus-mode .focus-trigger-zone {
  display: block;
  pointer-events: auto;
}

/* 专注模式下库侧栏：纯文字，无图标，无悬浮效果，背景跟随编辑区 */
body.focus-mode .library {
  border-right: none !important;
  box-shadow: none !important;
}

body.focus-mode .library .lib-header {
  border-bottom: none !important;
}

body.focus-mode .library .lib-ico,
body.focus-mode .library .lib-ico-folder,
body.focus-mode .library .lib-ico-file,
body.focus-mode .library .lib-ico-app {
  display: none !important;
}

body.focus-mode .library .lib-tg {
  display: inline-flex !important;
  opacity: 0.4;
}

/* 移除悬浮效果 */
body.focus-mode .library .lib-node:hover {
  background: transparent !important;
  transform: none !important;
  box-shadow: none !important;
}

/* 简化行间距和内边距 */
body.focus-mode .library .lib-node {
  padding: 3px 8px;
  gap: 0;
  min-height: 22px;
}

/* 文件名纯文字显示 */
body.focus-mode .library .lib-node .lib-name {
  padding-left: 0;
  font-weight: 400;
}

/* 选中态保持简单背景 */
body.focus-mode .library .lib-node.selected {
  background: rgba(127,127,127,0.1);
}

/* 大纲条目也简化 */
body.focus-mode .library .lib-outline .ol-item:hover {
  background: transparent !important;
  border-left-color: transparent !important;
  transform: none !important;
}

body.focus-mode .library .lib-outline .ol-tg {
  display: none !important;
}

/* 库按钮纯文字样式 */
body.focus-mode .library .lib-choose-btn,
body.focus-mode .library .lib-action-btn {
  background: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  padding: 4px 8px !important;
  font-weight: 400 !important;
  color: var(--muted) !important;
}

body.focus-mode .library .lib-choose-btn:hover,
body.focus-mode .library .lib-action-btn:hover {
  background: transparent !important;
  color: var(--fg) !important;
}

body.focus-mode .library .lib-action-btn.active {
  background: transparent !important;
  color: var(--fg) !important;
  font-weight: 500 !important;
}

/* ============ 专注模式样式结束 ============ */

/* ============ 自定义标题栏（无边框窗口）============ */
.custom-titlebar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: transparent;
  z-index: 10000;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* 拖动区域 */
.custom-titlebar-drag {
  flex: 1;
  height: 100%;
  -webkit-app-region: drag;
  app-region: drag;
  cursor: move;
}

/* 控制按钮容器 */
.custom-titlebar-controls {
  display: flex;
  align-items: center;
  height: 100%;
  -webkit-app-region: no-drag;
  app-region: no-drag;
  padding-right: 8px;
}
.custom-titlebar.controls-left {
  flex-direction: row-reverse;
}
.custom-titlebar.controls-left .custom-titlebar-controls {
  padding-right: 0;
  padding-left: 8px;
}

/* 控制按钮基础样式 - 极简文字样式 */
.custom-titlebar-btn {
  background: none;
  border: none;
  color: var(--fg);
  font-size: 18px;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: opacity 0.2s, background 0.2s;
  border-radius: 4px;
  margin: 0 2px;
  padding: 0;
  line-height: 1;
  font-weight: 300;
  opacity: 0.5;
  font-family: monospace;
}

/* 按钮悬停效果 */
.custom-titlebar-btn:hover {
  opacity: 0.8;
  background: rgba(127, 127, 127, 0.1);
}

/* 关闭按钮特殊样式 */
.custom-titlebar-btn.custom-titlebar-close {
  font-size: 20px;
}

.custom-titlebar-btn.custom-titlebar-close:hover {
  background: rgba(232, 17, 35, 0.9);
  color: white;
  opacity: 1;
}

/* 退出专注模式按钮样式 */
.custom-titlebar-btn.custom-titlebar-exit-focus {
  margin-right: 4px;
}
.custom-titlebar.controls-left .custom-titlebar-btn.custom-titlebar-exit-focus {
  margin-right: 0;
  margin-left: 4px;
}

/* 分隔线样式 */
.custom-titlebar-separator {
  display: inline-block;
  width: 1px;
  height: 20px;
  background: var(--border);
  opacity: 0.3;
  margin: 0 8px;
  vertical-align: middle;
}

/* 专注模式下调整内容区域，为自定义标题栏留出空间 */
body.focus-mode.custom-titlebar-active .container {
  padding-top: 30px;
  height: calc(100% - 30px) !important;
}

/* 专注模式下原生的触发区域要隐藏 */
body.focus-mode.custom-titlebar-active .focus-trigger-zone {
  display: none !important;
}

/* ========================================
   多标签栏样式
   ======================================== */

.tabbar {
  display: flex;
  align-items: center;
  height: 32px;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  padding: 0 4px;
  user-select: none;
  flex-shrink: 0;
  overflow: hidden;
}

.tabbar-tabs {
  display: flex;
  align-items: center;
  height: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  flex: 1;
  gap: 2px;
  /* 隐藏滚动条但保持滚动功能 */
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.tabbar-tabs::-webkit-scrollbar {
  display: none;
}

.tabbar-tab {
  display: flex;
  align-items: center;
  height: 28px;
  padding: 0 8px;
  background: transparent;
  border-radius: 4px 4px 0 0;
  cursor: pointer;
  font-size: 13px;
  color: var(--muted);
  gap: 6px;
  flex-shrink: 0;
  max-width: 180px;
  min-width: 80px;
  position: relative;
  transition: background 0.15s, color 0.15s;
}

.tabbar-tab:hover {
  background: var(--panel-bg);
  color: var(--fg);
}

.tabbar-tab.active {
  background: var(--panel-bg);
  color: var(--fg);
  font-weight: 500;
}

/* 活跃标签底部指示线 */
.tabbar-tab.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 4px;
  right: 4px;
  height: 2px;
  background: #3b82f6;
  border-radius: 2px 2px 0 0;
}

.tabbar-tab-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  opacity: 0.7;
}

.tabbar-tab-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}

/* 未保存标记 */
.tabbar-tab-dirty {
  color: #f59e0b;
  font-size: 8px;
  flex-shrink: 0;
  margin-left: -2px;
}

/* 关闭按钮 */
.tabbar-tab-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  opacity: 0;
  transition: opacity 0.15s, background 0.15s;
  flex-shrink: 0;
  margin-left: auto;
}

.tabbar-tab:hover .tabbar-tab-close,
.tabbar-tab.active .tabbar-tab-close {
  opacity: 0.6;
}

.tabbar-tab-close:hover {
  opacity: 1 !important;
  background: rgba(127, 127, 127, 0.2);
}

/* 有未保存内容时，始终显示 dirty 标记代替关闭按钮 */
.tabbar-tab.dirty .tabbar-tab-close {
  display: none;
}

.tabbar-tab.dirty:hover .tabbar-tab-close {
  display: flex;
}

.tabbar-tab.dirty:hover .tabbar-tab-dirty {
  display: none;
}

/* 新建标签按钮 */
.tabbar-new-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 4px;
  cursor: pointer;
  color: var(--muted);
  flex-shrink: 0;
  transition: background 0.15s, color 0.15s;
}

.tabbar-new-btn:hover {
  background: var(--panel-bg);
  color: var(--fg);
}

/* 拖拽样式 */
.tabbar-tab.dragging {
  opacity: 0.5;
}

.tabbar-tab.drag-over-left::before,
.tabbar-tab.drag-over-right::after {
  content: '';
  position: absolute;
  top: 4px;
  bottom: 4px;
  width: 2px;
  background: #3b82f6;
  border-radius: 1px;
}

.tabbar-tab.drag-over-left::before {
  left: -2px;
}

.tabbar-tab.drag-over-right::after {
  right: -2px;
}

.tabbar-context-menu {
  position: fixed;
  z-index: 9999;
  display: none;
  flex-direction: column;
  min-width: 180px;
  padding: 6px 0;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.18);
}

.tabbar-context-item {
  width: 100%;
  border: none;
  background: transparent;
  color: var(--fg);
  font: inherit;
  text-align: left;
  padding: 8px 16px;
  cursor: pointer;
  transition: background 0.15s ease;
}

.tabbar-context-item:hover {
  background: var(--panel-bg);
}

/* 深色模式下活跃标签指示线颜色 */
@media (prefers-color-scheme: dark) {
  .tabbar-tab.active::after {
    background: #60a5fa;
  }

  .tabbar-tab.drag-over-left::before,
  .tabbar-tab.drag-over-right::after {
    background: #60a5fa;
  }
}

/* 夜间模式 - 标签栏 */
body.dark-mode .tabbar {
  background: #0b0c0e !important;
  border-bottom-color: #1f2937 !important;
}

body.dark-mode .tabbar-tab {
  color: #9ca3af !important;
}

body.dark-mode .tabbar-tab:hover {
  background: rgba(255, 255, 255, 0.06) !important;
  color: #e5e7eb !important;
}

body.dark-mode .tabbar-tab.active {
  background: #1f2937 !important;
  color: #e5e7eb !important;
}

body.dark-mode .tabbar-tab.active::after {
  background: #60a5fa !important;
}

body.dark-mode .tabbar-tab-close:hover {
  background: rgba(255, 255, 255, 0.1) !important;
}

body.dark-mode .tabbar-new-btn {
  color: #9ca3af !important;
}

body.dark-mode .tabbar-new-btn:hover {
  background: rgba(255, 255, 255, 0.06) !important;
  color: #e5e7eb !important;
}

/* 专注模式下隐藏标签栏 */
body.focus-mode .tabbar {
  display: none;
}

/* 标签栏存在时，容器高度需要减去标签栏高度 */
#tabbar-container + .focus-trigger-zone + .container,
#tabbar-container + .container {
  height: calc(100% - 36px - 32px); /* 标题栏36px + 标签栏32px */
}

/* 专注模式下，标签栏隐藏，恢复原高度 */
body.focus-mode #tabbar-container + .focus-trigger-zone + .container,
body.focus-mode #tabbar-container + .container {
  height: calc(100% - 36px);
}
